<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>JabRefPreferences.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">JabRefMain (11 de nov. de 2021 10:35:43)</a> &gt; <a href="../../index.html" class="el_group">JabRef</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">net.sf.jabref</a> &gt; <span class="el_source">JabRefPreferences.java</span></div><h1>JabRefPreferences.java</h1><pre class="source lang-java linenums">/*  Copyright (C) 2003-2015 JabRef contributors.
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License along
 with this program; if not, write to the Free Software Foundation, Inc.,
 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */
package net.sf.jabref;

import java.awt.Color;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.Reader;
import java.io.StringReader;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.EnumSet;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.prefs.BackingStoreException;
import java.util.prefs.InvalidPreferencesFormatException;
import java.util.prefs.Preferences;
import java.util.stream.Collectors;

import javax.swing.JTable;
import javax.swing.UIManager;

import net.sf.jabref.bibtex.InternalBibtexFields;
import net.sf.jabref.exporter.CustomExportList;
import net.sf.jabref.exporter.ExportComparator;
import net.sf.jabref.exporter.FieldFormatterCleanups;
import net.sf.jabref.external.DroppedFileHandler;
import net.sf.jabref.gui.GUIGlobals;
import net.sf.jabref.gui.desktop.JabRefDesktop;
import net.sf.jabref.gui.entryeditor.EntryEditorTabList;
import net.sf.jabref.gui.maintable.PersistenceTableColumnListener;
import net.sf.jabref.gui.preftabs.ImportSettingsTab;
import net.sf.jabref.importer.CustomImportList;
import net.sf.jabref.logic.autocompleter.AutoCompletePreferences;
import net.sf.jabref.logic.cleanup.CleanupPreset;
import net.sf.jabref.logic.cleanup.FieldFormatterCleanup;
import net.sf.jabref.logic.formatter.bibtexfields.HtmlToLatexFormatter;
import net.sf.jabref.logic.formatter.bibtexfields.LatexCleanupFormatter;
import net.sf.jabref.logic.formatter.bibtexfields.NormalizeDateFormatter;
import net.sf.jabref.logic.formatter.bibtexfields.NormalizeMonthFormatter;
import net.sf.jabref.logic.formatter.bibtexfields.NormalizePagesFormatter;
import net.sf.jabref.logic.formatter.bibtexfields.UnitsToLatexFormatter;
import net.sf.jabref.logic.formatter.casechanger.ProtectTermsFormatter;
import net.sf.jabref.logic.l10n.Localization;
import net.sf.jabref.logic.labelpattern.GlobalLabelPattern;
import net.sf.jabref.logic.openoffice.OpenOfficePreferences;
import net.sf.jabref.logic.openoffice.StyleLoader;
import net.sf.jabref.logic.remote.RemotePreferences;
import net.sf.jabref.logic.util.OS;
import net.sf.jabref.logic.util.strings.StringUtil;
import net.sf.jabref.model.entry.CustomEntryType;
import net.sf.jabref.model.entry.EntryUtil;
import net.sf.jabref.specialfields.SpecialFieldsUtils;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

public class JabRefPreferences {
<span class="fc" id="L84">    private static final Log LOGGER = LogFactory.getLog(JabRefPreferences.class);</span>
    public static final String EXTERNAL_FILE_TYPES = &quot;externalFileTypes&quot;;

    /**
     * HashMap that contains all preferences which are set by default
     */
<span class="fc" id="L90">    public final Map&lt;String, Object&gt; defaults = new HashMap&lt;&gt;();</span>

    /* contents of the defaults HashMap that are defined in this class.
     * There are more default parameters in this map which belong to separate preference classes.
    */
    public static final String EMACS_PATH = &quot;emacsPath&quot;;
    public static final String EMACS_ADDITIONAL_PARAMETERS = &quot;emacsParameters&quot;;
    public static final String EMACS_23 = &quot;emacsUseV23InsertString&quot;;
    public static final String FONT_FAMILY = &quot;fontFamily&quot;;
    public static final String WIN_LOOK_AND_FEEL = &quot;lookAndFeel&quot;;
    public static final String LATEX_EDITOR_PATH = &quot;latexEditorPath&quot;;
    public static final String TEXSTUDIO_PATH = &quot;TeXstudioPath&quot;;
    public static final String WIN_EDT_PATH = &quot;winEdtPath&quot;;
    public static final String TEXMAKER_PATH = &quot;texmakerPath&quot;;
    public static final String LANGUAGE = &quot;language&quot;;
    public static final String NAMES_LAST_ONLY = &quot;namesLastOnly&quot;;
    public static final String ABBR_AUTHOR_NAMES = &quot;abbrAuthorNames&quot;;
    public static final String NAMES_NATBIB = &quot;namesNatbib&quot;;
    public static final String NAMES_FIRST_LAST = &quot;namesFf&quot;;
    public static final String BIBLATEX_DEFAULT_MODE = &quot;biblatexMode&quot;;
    public static final String NAMES_AS_IS = &quot;namesAsIs&quot;;
    public static final String TABLE_COLOR_CODES_ON = &quot;tableColorCodesOn&quot;;
    public static final String ENTRY_EDITOR_HEIGHT = &quot;entryEditorHeight&quot;;
    public static final String PREVIEW_PANEL_HEIGHT = &quot;previewPanelHeight&quot;;
    public static final String AUTO_RESIZE_MODE = &quot;autoResizeMode&quot;;
    public static final String WINDOW_MAXIMISED = &quot;windowMaximised&quot;;
    public static final String SIZE_Y = &quot;mainWindowSizeY&quot;;
    public static final String SIZE_X = &quot;mainWindowSizeX&quot;;
    public static final String POS_Y = &quot;mainWindowPosY&quot;;
    public static final String POS_X = &quot;mainWindowPosX&quot;;
    public static final String VIM_SERVER = &quot;vimServer&quot;;
    public static final String VIM = &quot;vim&quot;;
    public static final String LYXPIPE = &quot;lyxpipe&quot;;
    public static final String USE_DEFAULT_LOOK_AND_FEEL = &quot;useDefaultLookAndFeel&quot;;
    public static final String PROXY_PORT = &quot;proxyPort&quot;;
    public static final String PROXY_HOSTNAME = &quot;proxyHostname&quot;;
    public static final String PROXY_USE = &quot;useProxy&quot;;
    public static final String PROXY_USERNAME = &quot;proxyUsername&quot;;
    public static final String PROXY_PASSWORD = &quot;proxyPassword&quot;;
    public static final String PROXY_USE_AUTHENTICATION = &quot;useProxyAuthentication&quot;;
    public static final String TABLE_PRIMARY_SORT_FIELD = &quot;priSort&quot;;
    public static final String TABLE_PRIMARY_SORT_DESCENDING = &quot;priDescending&quot;;
    public static final String TABLE_SECONDARY_SORT_FIELD = &quot;secSort&quot;;
    public static final String TABLE_SECONDARY_SORT_DESCENDING = &quot;secDescending&quot;;
    public static final String TABLE_TERTIARY_SORT_FIELD = &quot;terSort&quot;;
    public static final String TABLE_TERTIARY_SORT_DESCENDING = &quot;terDescending&quot;;
    public static final String REFORMAT_FILE_ON_SAVE_AND_EXPORT = &quot;reformatFileOnSaveAndExport&quot;;
    public static final String EXPORT_IN_ORIGINAL_ORDER = &quot;exportInOriginalOrder&quot;;
    public static final String EXPORT_IN_SPECIFIED_ORDER = &quot;exportInSpecifiedOrder&quot;;
    public static final String EXPORT_PRIMARY_SORT_FIELD = &quot;exportPriSort&quot;;
    public static final String EXPORT_PRIMARY_SORT_DESCENDING = &quot;exportPriDescending&quot;;
    public static final String EXPORT_SECONDARY_SORT_FIELD = &quot;exportSecSort&quot;;
    public static final String EXPORT_SECONDARY_SORT_DESCENDING = &quot;exportSecDescending&quot;;
    public static final String EXPORT_TERTIARY_SORT_FIELD = &quot;exportTerSort&quot;;
    public static final String EXPORT_TERTIARY_SORT_DESCENDING = &quot;exportTerDescending&quot;;
    public static final String NEWLINE = &quot;newline&quot;;
    public static final String COLUMN_WIDTHS = &quot;columnWidths&quot;;
    public static final String COLUMN_NAMES = &quot;columnNames&quot;;
    public static final String SIDE_PANE_COMPONENT_PREFERRED_POSITIONS = &quot;sidePaneComponentPreferredPositions&quot;;
    public static final String SIDE_PANE_COMPONENT_NAMES = &quot;sidePaneComponentNames&quot;;
    public static final String XMP_PRIVACY_FILTERS = &quot;xmpPrivacyFilters&quot;;
    public static final String USE_XMP_PRIVACY_FILTER = &quot;useXmpPrivacyFilter&quot;;
    public static final String SEARCH_MODE_FILTER = &quot;searchModeFilter&quot;;
    public static final String SEARCH_CASE_SENSITIVE = &quot;caseSensitiveSearch&quot;;
    public static final String DEFAULT_AUTO_SORT = &quot;defaultAutoSort&quot;;
    public static final String DEFAULT_SHOW_SOURCE = &quot;defaultShowSource&quot;;
    public static final String STRINGS_SIZE_Y = &quot;stringsSizeY&quot;;
    public static final String STRINGS_SIZE_X = &quot;stringsSizeX&quot;;
    public static final String STRINGS_POS_Y = &quot;stringsPosY&quot;;
    public static final String STRINGS_POS_X = &quot;stringsPosX&quot;;
    public static final String DUPLICATES_SIZE_Y = &quot;duplicatesSizeY&quot;;
    public static final String DUPLICATES_SIZE_X = &quot;duplicatesSizeX&quot;;
    public static final String DUPLICATES_POS_Y = &quot;duplicatesPosY&quot;;
    public static final String DUPLICATES_POS_X = &quot;duplicatesPosX&quot;;
    public static final String MERGEENTRIES_SIZE_Y = &quot;mergeEntriesSizeY&quot;;
    public static final String MERGEENTRIES_SIZE_X = &quot;mergeEntriesSizeX&quot;;
    public static final String MERGEENTRIES_POS_Y = &quot;mergeEntriesPosY&quot;;
    public static final String MERGEENTRIES_POS_X = &quot;mergeEntriesPosX&quot;;
    public static final String PREAMBLE_SIZE_Y = &quot;preambleSizeY&quot;;
    public static final String PREAMBLE_SIZE_X = &quot;preambleSizeX&quot;;
    public static final String PREAMBLE_POS_Y = &quot;preamblePosY&quot;;
    public static final String PREAMBLE_POS_X = &quot;preamblePosX&quot;;
    public static final String LAST_EDITED = &quot;lastEdited&quot;;
    public static final String OPEN_LAST_EDITED = &quot;openLastEdited&quot;;
    public static final String LAST_FOCUSED = &quot;lastFocused&quot;;
    public static final String BACKUP = &quot;backup&quot;;
    public static final String ENTRY_TYPE_FORM_WIDTH = &quot;entryTypeFormWidth&quot;;
    public static final String ENTRY_TYPE_FORM_HEIGHT_FACTOR = &quot;entryTypeFormHeightFactor&quot;;
    public static final String AUTO_OPEN_FORM = &quot;autoOpenForm&quot;;
    public static final String FILE_WORKING_DIRECTORY = &quot;fileWorkingDirectory&quot;;
    public static final String IMPORT_WORKING_DIRECTORY = &quot;importWorkingDirectory&quot;;
    public static final String EXPORT_WORKING_DIRECTORY = &quot;exportWorkingDirectory&quot;;
    public static final String WORKING_DIRECTORY = &quot;workingDirectory&quot;;
    public static final String NUMBER_COL_WIDTH = &quot;numberColWidth&quot;;
    public static final String AUTO_COMPLETE = &quot;autoComplete&quot;;
    public static final String SEARCH_PANE_POS_Y = &quot;searchPanePosY&quot;;
    public static final String SEARCH_PANE_POS_X = &quot;searchPanePosX&quot;;
    public static final String SEARCH_REG_EXP = &quot;regExpSearch&quot;;
    public static final String EDITOR_EMACS_KEYBINDINGS = &quot;editorEMACSkeyBindings&quot;;
    public static final String EDITOR_EMACS_KEYBINDINGS_REBIND_CA = &quot;editorEMACSkeyBindingsRebindCA&quot;;
    public static final String EDITOR_EMACS_KEYBINDINGS_REBIND_CF = &quot;editorEMACSkeyBindingsRebindCF&quot;;
    public static final String GROUP_SHOW_NUMBER_OF_ELEMENTS = &quot;groupShowNumberOfElements&quot;;
    public static final String GROUP_AUTO_HIDE = &quot;groupAutoHide&quot;;
    public static final String GROUP_AUTO_SHOW = &quot;groupAutoShow&quot;;
    public static final String GROUP_EXPAND_TREE = &quot;groupExpandTree&quot;;
    public static final String GROUP_SHOW_DYNAMIC = &quot;groupShowDynamic&quot;;
    public static final String GROUP_SHOW_ICONS = &quot;groupShowIcons&quot;;
    public static final String GROUPS_DEFAULT_FIELD = &quot;groupsDefaultField&quot;;
    public static final String GROUP_SELECT_MATCHES = &quot;groupSelectMatches&quot;;
    public static final String GROUP_SHOW_OVERLAPPING = &quot;groupShowOverlapping&quot;;
    public static final String GROUP_INVERT_SELECTIONS = &quot;groupInvertSelections&quot;;
    public static final String GROUP_INTERSECT_SELECTIONS = &quot;groupIntersectSelections&quot;;
    public static final String GROUP_FLOAT_SELECTIONS = &quot;groupFloatSelections&quot;;
    public static final String EDIT_GROUP_MEMBERSHIP_MODE = &quot;groupEditGroupMembershipMode&quot;;
    public static final String GROUP_KEYWORD_SEPARATOR = &quot;groupKeywordSeparator&quot;;
    public static final String AUTO_ASSIGN_GROUP = &quot;autoAssignGroup&quot;;
    public static final String LIST_OF_FILE_COLUMNS = &quot;listOfFileColumns&quot;;
    public static final String EXTRA_FILE_COLUMNS = &quot;extraFileColumns&quot;;
    public static final String ARXIV_COLUMN = &quot;arxivColumn&quot;;
    public static final String FILE_COLUMN = &quot;fileColumn&quot;;
    public static final String PREFER_URL_DOI = &quot;preferUrlDoi&quot;;
    public static final String URL_COLUMN = &quot;urlColumn&quot;;
    public static final String DISABLE_ON_MULTIPLE_SELECTION = &quot;disableOnMultipleSelection&quot;;
    public static final String CTRL_CLICK = &quot;ctrlClick&quot;;
    public static final String INCOMPLETE_ENTRY_BACKGROUND = &quot;incompleteEntryBackground&quot;;
    public static final String FIELD_EDITOR_TEXT_COLOR = &quot;fieldEditorTextColor&quot;;
    public static final String ACTIVE_FIELD_EDITOR_BACKGROUND_COLOR = &quot;activeFieldEditorBackgroundColor&quot;;
    public static final String INVALID_FIELD_BACKGROUND_COLOR = &quot;invalidFieldBackgroundColor&quot;;
    public static final String VALID_FIELD_BACKGROUND_COLOR = &quot;validFieldBackgroundColor&quot;;
    public static final String MARKED_ENTRY_BACKGROUND5 = &quot;markedEntryBackground5&quot;;
    public static final String MARKED_ENTRY_BACKGROUND4 = &quot;markedEntryBackground4&quot;;
    public static final String MARKED_ENTRY_BACKGROUND3 = &quot;markedEntryBackground3&quot;;
    public static final String MARKED_ENTRY_BACKGROUND2 = &quot;markedEntryBackground2&quot;;
    public static final String MARKED_ENTRY_BACKGROUND1 = &quot;markedEntryBackground1&quot;;
    public static final String MARKED_ENTRY_BACKGROUND0 = &quot;markedEntryBackground0&quot;;
    public static final String VERY_GRAYED_OUT_TEXT = &quot;veryGrayedOutText&quot;;
    public static final String VERY_GRAYED_OUT_BACKGROUND = &quot;veryGrayedOutBackground&quot;;
    public static final String GRAYED_OUT_TEXT = &quot;grayedOutText&quot;;
    public static final String GRAYED_OUT_BACKGROUND = &quot;grayedOutBackground&quot;;
    public static final String GRID_COLOR = &quot;gridColor&quot;;
    public static final String TABLE_TEXT = &quot;tableText&quot;;
    public static final String TABLE_OPT_FIELD_BACKGROUND = &quot;tableOptFieldBackground&quot;;
    public static final String TABLE_REQ_FIELD_BACKGROUND = &quot;tableReqFieldBackground&quot;;
    public static final String TABLE_BACKGROUND = &quot;tableBackground&quot;;
    public static final String TABLE_SHOW_GRID = &quot;tableShowGrid&quot;;
    public static final String TABLE_ROW_PADDING = &quot;tableRowPadding&quot;;
    public static final String MENU_FONT_SIZE = &quot;menuFontSize&quot;;
    public static final String OVERRIDE_DEFAULT_FONTS = &quot;overrideDefaultFonts&quot;;
    public static final String FONT_SIZE = &quot;fontSize&quot;;
    public static final String FONT_STYLE = &quot;fontStyle&quot;;
    public static final String RECENT_FILES = &quot;recentFiles&quot;;
    public static final String GENERAL_FIELDS = &quot;generalFields&quot;;
    public static final String RENAME_ON_MOVE_FILE_TO_FILE_DIR = &quot;renameOnMoveFileToFileDir&quot;;
    public static final String MEMORY_STICK_MODE = &quot;memoryStickMode&quot;;
    public static final String DEFAULT_OWNER = &quot;defaultOwner&quot;;
    public static final String GROUPS_VISIBLE_ROWS = &quot;groupsVisibleRows&quot;;
    public static final String DEFAULT_ENCODING = &quot;defaultEncoding&quot;;
    public static final String TOOLBAR_VISIBLE = &quot;toolbarVisible&quot;;
    public static final String HIGHLIGHT_GROUPS_MATCHING = &quot;highlightGroupsMatching&quot;;
    public static final String UPDATE_TIMESTAMP = &quot;updateTimestamp&quot;;
    public static final String TIME_STAMP_FIELD = &quot;timeStampField&quot;;
    public static final String TIME_STAMP_FORMAT = &quot;timeStampFormat&quot;;
    public static final String OVERWRITE_TIME_STAMP = &quot;overwriteTimeStamp&quot;;
    public static final String USE_TIME_STAMP = &quot;useTimeStamp&quot;;
    public static final String WARN_ABOUT_DUPLICATES_IN_INSPECTION = &quot;warnAboutDuplicatesInInspection&quot;;
    public static final String UNMARK_ALL_ENTRIES_BEFORE_IMPORTING = &quot;unmarkAllEntriesBeforeImporting&quot;;
    public static final String MARK_IMPORTED_ENTRIES = &quot;markImportedEntries&quot;;
    public static final String GENERATE_KEYS_AFTER_INSPECTION = &quot;generateKeysAfterInspection&quot;;
    public static final String NON_WRAPPABLE_FIELDS = &quot;nonWrappableFields&quot;;
    public static final String PUT_BRACES_AROUND_CAPITALS = &quot;putBracesAroundCapitals&quot;;
    public static final String RESOLVE_STRINGS_ALL_FIELDS = &quot;resolveStringsAllFields&quot;;
    public static final String DO_NOT_RESOLVE_STRINGS_FOR = &quot;doNotResolveStringsFor&quot;;
    public static final String PREVIEW_PRINT_BUTTON = &quot;previewPrintButton&quot;;
    public static final String PREVIEW_1 = &quot;preview1&quot;;
    public static final String PREVIEW_0 = &quot;preview0&quot;;
    public static final String ACTIVE_PREVIEW = &quot;activePreview&quot;;
    public static final String PREVIEW_ENABLED = &quot;previewEnabled&quot;;
    public static final String MERGE_ENTRIES_DIFF_MODE = &quot;mergeEntriesDiffMode&quot;;

    public static final String CUSTOM_EXPORT_FORMAT = &quot;customExportFormat&quot;;
    public static final String CUSTOM_IMPORT_FORMAT = &quot;customImportFormat&quot;;
    public static final String BINDINGS = &quot;bindings&quot;;
    public static final String BIND_NAMES = &quot;bindNames&quot;;
    public static final String MARKED_ENTRY_BACKGROUND = &quot;markedEntryBackground&quot;;
    public static final String KEY_PATTERN_REGEX = &quot;KeyPatternRegex&quot;;
    public static final String KEY_PATTERN_REPLACEMENT = &quot;KeyPatternReplacement&quot;;

    // Currently, it is not possible to specify defaults for specific entry types
    // When this should be made possible, the code to inspect is net.sf.jabref.gui.preftabs.LabelPatternPrefTab.storeSettings() -&gt; LabelPattern keypatterns = getLabelPattern(); etc
    public static final String DEFAULT_LABEL_PATTERN = &quot;defaultLabelPattern&quot;;

    public static final String SEARCH_MODE_FLOAT = &quot;floatSearch&quot;;
    public static final String GRAY_OUT_NON_HITS = &quot;grayOutNonHits&quot;;
    public static final String CONFIRM_DELETE = &quot;confirmDelete&quot;;
    public static final String WARN_BEFORE_OVERWRITING_KEY = &quot;warnBeforeOverwritingKey&quot;;
    public static final String AVOID_OVERWRITING_KEY = &quot;avoidOverwritingKey&quot;;
    public static final String DISPLAY_KEY_WARNING_DIALOG_AT_STARTUP = &quot;displayKeyWarningDialogAtStartup&quot;;
    public static final String DIALOG_WARNING_FOR_EMPTY_KEY = &quot;dialogWarningForEmptyKey&quot;;
    public static final String DIALOG_WARNING_FOR_DUPLICATE_KEY = &quot;dialogWarningForDuplicateKey&quot;;
    public static final String OVERWRITE_OWNER = &quot;overwriteOwner&quot;;
    public static final String USE_OWNER = &quot;useOwner&quot;;
    public static final String AUTOLINK_EXACT_KEY_ONLY = &quot;autolinkExactKeyOnly&quot;;
    public static final String SHOW_FILE_LINKS_UPGRADE_WARNING = &quot;showFileLinksUpgradeWarning&quot;;
    public static final String SEARCH_DIALOG_HEIGHT = &quot;searchDialogHeight&quot;;
    public static final String SEARCH_DIALOG_WIDTH = &quot;searchDialogWidth&quot;;
    public static final String IMPORT_INSPECTION_DIALOG_HEIGHT = &quot;importInspectionDialogHeight&quot;;
    public static final String IMPORT_INSPECTION_DIALOG_WIDTH = &quot;importInspectionDialogWidth&quot;;
    public static final String SIDE_PANE_WIDTH = &quot;sidePaneWidth&quot;;
    public static final String LAST_USED_EXPORT = &quot;lastUsedExport&quot;;
    public static final String LAST_USED_IMPORT = &quot;lastUsedImport&quot;;
    public static final String FLOAT_MARKED_ENTRIES = &quot;floatMarkedEntries&quot;;
    public static final String CITE_COMMAND = &quot;citeCommand&quot;;
    public static final String EXTERNAL_JOURNAL_LISTS = &quot;externalJournalLists&quot;;
    public static final String PERSONAL_JOURNAL_LIST = &quot;personalJournalList&quot;;
    public static final String GENERATE_KEYS_BEFORE_SAVING = &quot;generateKeysBeforeSaving&quot;;
    public static final String EMAIL_SUBJECT = &quot;emailSubject&quot;;
    public static final String OPEN_FOLDERS_OF_ATTACHED_FILES = &quot;openFoldersOfAttachedFiles&quot;;
    public static final String KEY_GEN_ALWAYS_ADD_LETTER = &quot;keyGenAlwaysAddLetter&quot;;
    public static final String KEY_GEN_FIRST_LETTER_A = &quot;keyGenFirstLetterA&quot;;
    public static final String VALUE_DELIMITERS2 = &quot;valueDelimiters&quot;;
    public static final String ENFORCE_LEGAL_BIBTEX_KEY = &quot;enforceLegalBibtexKey&quot;;
    public static final String PROMPT_BEFORE_USING_AUTOSAVE = &quot;promptBeforeUsingAutosave&quot;;
    public static final String AUTO_SAVE_INTERVAL = &quot;autoSaveInterval&quot;;
    public static final String AUTO_SAVE = &quot;autoSave&quot;;
    public static final String USE_LOCK_FILES = &quot;useLockFiles&quot;;
    public static final String RUN_AUTOMATIC_FILE_SEARCH = &quot;runAutomaticFileSearch&quot;;
    public static final String NUMERIC_FIELDS = &quot;numericFields&quot;;
    public static final String DEFAULT_REG_EXP_SEARCH_EXPRESSION_KEY = &quot;defaultRegExpSearchExpression&quot;;
    public static final String REG_EXP_SEARCH_EXPRESSION_KEY = &quot;regExpSearchExpression&quot;;
    public static final String AUTOLINK_USE_REG_EXP_SEARCH_KEY = &quot;useRegExpSearch&quot;;
    public static final String DB_CONNECT_USERNAME = &quot;dbConnectUsername&quot;;
    public static final String DB_CONNECT_DATABASE = &quot;dbConnectDatabase&quot;;
    public static final String DB_CONNECT_HOSTNAME = &quot;dbConnectHostname&quot;;
    public static final String DB_CONNECT_SERVER_TYPE = &quot;dbConnectServerType&quot;;
    public static final String BIB_LOC_AS_PRIMARY_DIR = &quot;bibLocAsPrimaryDir&quot;;
    public static final String SELECTED_FETCHER_INDEX = &quot;selectedFetcherIndex&quot;;
    public static final String WEB_SEARCH_VISIBLE = &quot;webSearchVisible&quot;;
    public static final String ALLOW_FILE_AUTO_OPEN_BROWSE = &quot;allowFileAutoOpenBrowse&quot;;
    public static final String CUSTOM_TAB_NAME = &quot;customTabName_&quot;;
    public static final String CUSTOM_TAB_FIELDS = &quot;customTabFields_&quot;;
    public static final String USE_UNIT_FORMATTER_ON_SEARCH = &quot;useUnitFormatterOnSearch&quot;;
    public static final String USE_CASE_KEEPER_ON_SEARCH = &quot;useCaseKeeperOnSearch&quot;;
    public static final String USE_CONVERT_TO_EQUATION = &quot;useConvertToEquation&quot;;
    public static final String USE_IEEE_ABRV = &quot;useIEEEAbrv&quot;;

    public static final String AKS_AUTO_NAMING_PDFS_AGAIN = &quot;AskAutoNamingPDFsAgain&quot;;
    public static final String CLEANUP_DOI = &quot;CleanUpDOI&quot;;
    public static final String CLEANUP_MOVE_PDF = &quot;CleanUpMovePDF&quot;;
    public static final String CLEANUP_MAKE_PATHS_RELATIVE = &quot;CleanUpMakePathsRelative&quot;;
    public static final String CLEANUP_RENAME_PDF = &quot;CleanUpRenamePDF&quot;;
    public static final String CLEANUP_RENAME_PDF_ONLY_RELATIVE_PATHS = &quot;CleanUpRenamePDFonlyRelativePaths&quot;;
    public static final String CLEANUP_UPGRADE_EXTERNAL_LINKS = &quot;CleanUpUpgradeExternalLinks&quot;;
    public static final String CLEANUP_CONVERT_TO_BIBLATEX = &quot;CleanUpConvertToBiblatex&quot;;
    public static final String CLEANUP_FIX_FILE_LINKS = &quot;CleanUpFixFileLinks&quot;;
    public static final String CLEANUP_FORMATTERS = &quot;CleanUpFormatters&quot;;
    public static final CleanupPreset CLEANUP_DEFAULT_PRESET;
    static {
<span class="fc" id="L347">        EnumSet&lt;CleanupPreset.CleanupStep&gt; deactivedJobs = EnumSet.of(</span>
<span class="fc" id="L348">                CleanupPreset.CleanupStep.CLEAN_UP_UPGRADE_EXTERNAL_LINKS,</span>
<span class="fc" id="L349">                CleanupPreset.CleanupStep.RENAME_PDF_ONLY_RELATIVE_PATHS,</span>
<span class="fc" id="L350">                CleanupPreset.CleanupStep.CONVERT_TO_BIBLATEX);</span>

<span class="fc" id="L352">        List&lt;FieldFormatterCleanup&gt; activeFormatterCleanups = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L353">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;pages&quot;, new NormalizePagesFormatter()));</span>
<span class="fc" id="L354">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;date&quot;, new NormalizeDateFormatter()));</span>
<span class="fc" id="L355">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;month&quot;, new NormalizeMonthFormatter()));</span>
<span class="fc" id="L356">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;title&quot;, new ProtectTermsFormatter()));</span>
<span class="fc" id="L357">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;title&quot;, new UnitsToLatexFormatter()));</span>
<span class="fc" id="L358">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;title&quot;, new LatexCleanupFormatter()));</span>
<span class="fc" id="L359">        activeFormatterCleanups.add(new FieldFormatterCleanup(&quot;title&quot;, new HtmlToLatexFormatter()));</span>
<span class="fc" id="L360">        FieldFormatterCleanups formatterCleanups = new FieldFormatterCleanups(true, activeFormatterCleanups);</span>
<span class="fc" id="L361">        CLEANUP_DEFAULT_PRESET = new CleanupPreset(EnumSet.complementOf(deactivedJobs), formatterCleanups);</span>
    }

    public static final String PREF_IMPORT_DEFAULT_PDF_IMPORT_STYLE = &quot;importDefaultPDFimportStyle&quot;;
    public static final String PREF_IMPORT_ALWAYSUSE = &quot;importAlwaysUsePDFImportStyle&quot;;
    public static final String PREF_IMPORT_FILENAMEPATTERN = &quot;importFileNamePattern&quot;;


    public static final String PUSH_TO_APPLICATION = &quot;pushToApplication&quot;;

    /**
     * The OpenOffice/LibreOffice connection preferences are:
     * OO_PATH main directory for OO/LO installation, used to detect location on Win/OS X when using manual connect
     * OO_EXECUTABLE_PATH path to soffice-file
     * OO_JARS_PATH directory that contains juh.jar, jurt.jar, ridl.jar, unoil.jar
     * OO_SYNC_WHEN_CITING true if the reference list is updated when adding a new citation
     * OO_SHOW_PANEL true if the OO panel is shown on startup
     * OO_USE_ALL_OPEN_DATABASES true if all databases should be used when citing
     * OO_BIBLIOGRAPHY_STYLE_FILE path to the used style file
     * OO_EXTERNAL_STYLE_FILES list with paths to external style files
     * STYLES_*_* size and position of &quot;Select style&quot; dialog
     */
    public static final String OO_EXECUTABLE_PATH = &quot;ooExecutablePath&quot;;
    public static final String OO_PATH = &quot;ooPath&quot;;
    public static final String OO_JARS_PATH = &quot;ooJarsPath&quot;;
    public static final String OO_SHOW_PANEL = &quot;showOOPanel&quot;;
    public static final String OO_SYNC_WHEN_CITING = &quot;syncOOWhenCiting&quot;;
    public static final String OO_USE_ALL_OPEN_BASES = &quot;useAllOpenBases&quot;;
    public static final String OO_BIBLIOGRAPHY_STYLE_FILE = &quot;ooBibliographyStyleFile&quot;;
    public static final String OO_EXTERNAL_STYLE_FILES = &quot;ooExternalStyleFiles&quot;;
    public static final String STYLES_SIZE_Y = &quot;stylesSizeY&quot;;
    public static final String STYLES_SIZE_X = &quot;stylesSizeX&quot;;
    public static final String STYLES_POS_Y = &quot;stylesPosY&quot;;
    public static final String STYLES_POS_X = &quot;stylesPosX&quot;;

    //non-default preferences
    private static final String CUSTOM_TYPE_NAME = &quot;customTypeName_&quot;;
    private static final String CUSTOM_TYPE_REQ = &quot;customTypeReq_&quot;;
    private static final String CUSTOM_TYPE_OPT = &quot;customTypeOpt_&quot;;
    private static final String CUSTOM_TYPE_PRIOPT = &quot;customTypePriOpt_&quot;;

<span class="fc" id="L402">    private static final char[][] VALUE_DELIMITERS = new char[][] { {'&quot;', '&quot;'}, {'{', '}'}};</span>


    public String WRAPPED_USERNAME;
    public final String MARKING_WITH_NUMBER_PATTERN;

    private final Preferences prefs;

<span class="fc" id="L410">    private final Set&lt;String&gt; putBracesAroundCapitalsFields = new HashSet&lt;&gt;(4);</span>
<span class="fc" id="L411">    private final Set&lt;String&gt; nonWrappableFields = new HashSet&lt;&gt;(5);</span>
    private GlobalLabelPattern keyPattern;

    // Object containing custom export formats:
    public final CustomExportList customExports;

    // Helper string
<span class="fc" id="L418">    private static final String USER_HOME = System.getProperty(&quot;user.home&quot;);</span>

    /**
     * Set with all custom {@link ImportFormat}s
     */
    public final CustomImportList customImports;

    // Object containing info about customized entry editor tabs.
    private EntryEditorTabList tabList;

    // The following field is used as a global variable during the export of a database.
    // By setting this field to the path of the database's default file directory, formatters
    // that should resolve external file paths can access this field. This is an ugly hack
    // to solve the problem of formatters not having access to any context except for the
    // string to be formatted and possible formatter arguments.
    public List&lt;String&gt; fileDirForDatabase;

    // The following field is used as a global variable during the export of a database.
    // It is used to hold custom name formatters defined by a custom export filter.
    // It is set before the export starts:
    public Map&lt;String, String&gt; customExportNameFormatters;

    // The only instance of this class:
<span class="fc" id="L441">    private static JabRefPreferences singleton;</span>


    public static JabRefPreferences getInstance() {
<span class="fc bfc" id="L445" title="All 2 branches covered.">        if (JabRefPreferences.singleton == null) {</span>
<span class="fc" id="L446">            JabRefPreferences.singleton = new JabRefPreferences();</span>
        }
<span class="fc" id="L448">        return JabRefPreferences.singleton;</span>
    }

    // The constructor is made private to enforce this as a singleton class:
<span class="fc" id="L452">    private JabRefPreferences() {</span>
        try {
<span class="pc bpc" id="L454" title="1 of 2 branches missed.">            if (new File(&quot;jabref.xml&quot;).exists()) {</span>
<span class="nc" id="L455">                importPreferences(&quot;jabref.xml&quot;);</span>
            }
<span class="nc" id="L457">        } catch (JabRefException e) {</span>
<span class="nc" id="L458">            LOGGER.warn(&quot;Could not import preferences from jabref.xml: &quot; + e.getMessage(), e);</span>
        }

        // load user preferences
<span class="fc" id="L462">        prefs = Preferences.userNodeForPackage(JabRefMain.class);</span>

<span class="fc" id="L464">        defaults.put(TEXMAKER_PATH, JabRefDesktop.getNativeDesktop().detectProgramPath(&quot;texmaker&quot;, &quot;Texmaker&quot;));</span>
<span class="fc" id="L465">        defaults.put(WIN_EDT_PATH, JabRefDesktop.getNativeDesktop().detectProgramPath(&quot;WinEdt&quot;, &quot;WinEdt Team\\WinEdt&quot;));</span>
<span class="fc" id="L466">        defaults.put(LATEX_EDITOR_PATH, JabRefDesktop.getNativeDesktop().detectProgramPath(&quot;LEd&quot;, &quot;LEd&quot;));</span>
<span class="fc" id="L467">        defaults.put(TEXSTUDIO_PATH, JabRefDesktop.getNativeDesktop().detectProgramPath(&quot;texstudio&quot;, &quot;TeXstudio&quot;));</span>

<span class="fc" id="L469">        defaults.put(BIBLATEX_DEFAULT_MODE, false);</span>

<span class="pc bpc" id="L471" title="1 of 2 branches missed.">        if (OS.OS_X) {</span>
<span class="nc" id="L472">            defaults.put(EMACS_PATH, &quot;emacsclient&quot;);</span>
<span class="nc" id="L473">            defaults.put(EMACS_23, true);</span>
<span class="nc" id="L474">            defaults.put(EMACS_ADDITIONAL_PARAMETERS, &quot;-n -e&quot;);</span>
<span class="nc" id="L475">            defaults.put(FONT_FAMILY, &quot;SansSerif&quot;);</span>
<span class="nc" id="L476">            defaults.put(WIN_LOOK_AND_FEEL, UIManager.getSystemLookAndFeelClassName());</span>

<span class="pc bpc" id="L478" title="1 of 2 branches missed.">        } else if (OS.WINDOWS) {</span>
<span class="nc" id="L479">            defaults.put(WIN_LOOK_AND_FEEL, &quot;com.jgoodies.looks.windows.WindowsLookAndFeel&quot;);</span>
<span class="nc" id="L480">            defaults.put(EMACS_PATH, &quot;emacsclient.exe&quot;);</span>
<span class="nc" id="L481">            defaults.put(EMACS_23, true);</span>
<span class="nc" id="L482">            defaults.put(EMACS_ADDITIONAL_PARAMETERS, &quot;-n -e&quot;);</span>
<span class="nc" id="L483">            defaults.put(FONT_FAMILY, &quot;Arial&quot;);</span>

<span class="nc" id="L485">        } else {</span>
            // Linux
<span class="fc" id="L487">            defaults.put(WIN_LOOK_AND_FEEL, &quot;com.jgoodies.plaf.plastic.Plastic3DLookAndFeel&quot;);</span>
<span class="fc" id="L488">            defaults.put(FONT_FAMILY, &quot;SansSerif&quot;);</span>

<span class="fc" id="L490">            defaults.put(EMACS_PATH, &quot;gnuclient&quot;);</span>
<span class="fc" id="L491">            defaults.put(EMACS_23, false);</span>
<span class="fc" id="L492">            defaults.put(EMACS_ADDITIONAL_PARAMETERS, &quot;-batch -eval&quot;);</span>
        }
<span class="fc" id="L494">        defaults.put(PUSH_TO_APPLICATION, &quot;TeXstudio&quot;);</span>

<span class="fc" id="L496">        defaults.put(RECENT_FILES, &quot;&quot;);</span>
<span class="fc" id="L497">        defaults.put(EXTERNAL_FILE_TYPES, &quot;&quot;);</span>
<span class="fc" id="L498">        defaults.put(KEY_PATTERN_REGEX, &quot;&quot;);</span>
<span class="fc" id="L499">        defaults.put(KEY_PATTERN_REPLACEMENT, &quot;&quot;);</span>

        // Proxy
<span class="fc" id="L502">        defaults.put(PROXY_USE, Boolean.FALSE);</span>
<span class="fc" id="L503">        defaults.put(PROXY_HOSTNAME, &quot;&quot;);</span>
<span class="fc" id="L504">        defaults.put(PROXY_PORT, &quot;80&quot;);</span>
<span class="fc" id="L505">        defaults.put(PROXY_USE_AUTHENTICATION, Boolean.FALSE);</span>
<span class="fc" id="L506">        defaults.put(PROXY_USERNAME, &quot;&quot;);</span>
<span class="fc" id="L507">        defaults.put(PROXY_PASSWORD, &quot;&quot;);</span>

<span class="fc" id="L509">        defaults.put(USE_DEFAULT_LOOK_AND_FEEL, Boolean.TRUE);</span>
<span class="fc" id="L510">        defaults.put(LYXPIPE, USER_HOME + File.separator + &quot;.lyx/lyxpipe&quot;);</span>
<span class="fc" id="L511">        defaults.put(VIM, &quot;vim&quot;);</span>
<span class="fc" id="L512">        defaults.put(VIM_SERVER, &quot;vim&quot;);</span>
<span class="fc" id="L513">        defaults.put(POS_X, 0);</span>
<span class="fc" id="L514">        defaults.put(POS_Y, 0);</span>
<span class="fc" id="L515">        defaults.put(SIZE_X, 1024);</span>
<span class="fc" id="L516">        defaults.put(SIZE_Y, 768);</span>
<span class="fc" id="L517">        defaults.put(WINDOW_MAXIMISED, Boolean.FALSE);</span>
<span class="fc" id="L518">        defaults.put(AUTO_RESIZE_MODE, JTable.AUTO_RESIZE_ALL_COLUMNS);</span>
<span class="fc" id="L519">        defaults.put(PREVIEW_PANEL_HEIGHT, 200);</span>
<span class="fc" id="L520">        defaults.put(ENTRY_EDITOR_HEIGHT, 400);</span>
<span class="fc" id="L521">        defaults.put(TABLE_COLOR_CODES_ON, Boolean.FALSE);</span>
<span class="fc" id="L522">        defaults.put(NAMES_AS_IS, Boolean.FALSE); // &quot;Show names unchanged&quot;</span>
<span class="fc" id="L523">        defaults.put(NAMES_FIRST_LAST, Boolean.FALSE); // &quot;Show 'Firstname Lastname'&quot;</span>
<span class="fc" id="L524">        defaults.put(NAMES_NATBIB, Boolean.TRUE); // &quot;Natbib style&quot;</span>
<span class="fc" id="L525">        defaults.put(ABBR_AUTHOR_NAMES, Boolean.TRUE); // &quot;Abbreviate names&quot;</span>
<span class="fc" id="L526">        defaults.put(NAMES_LAST_ONLY, Boolean.TRUE); // &quot;Show last names only&quot;</span>
        // system locale as default
<span class="fc" id="L528">        defaults.put(LANGUAGE, Locale.getDefault().getLanguage());</span>

        // Sorting preferences
<span class="fc" id="L531">        defaults.put(TABLE_PRIMARY_SORT_FIELD, &quot;author&quot;);</span>
<span class="fc" id="L532">        defaults.put(TABLE_PRIMARY_SORT_DESCENDING, Boolean.FALSE);</span>
<span class="fc" id="L533">        defaults.put(TABLE_SECONDARY_SORT_FIELD, &quot;year&quot;);</span>
<span class="fc" id="L534">        defaults.put(TABLE_SECONDARY_SORT_DESCENDING, Boolean.TRUE);</span>
<span class="fc" id="L535">        defaults.put(TABLE_TERTIARY_SORT_FIELD, &quot;title&quot;);</span>
<span class="fc" id="L536">        defaults.put(TABLE_TERTIARY_SORT_DESCENDING, Boolean.FALSE);</span>

<span class="fc" id="L538">        defaults.put(REFORMAT_FILE_ON_SAVE_AND_EXPORT, Boolean.FALSE);</span>

        // export order
<span class="fc" id="L541">        defaults.put(EXPORT_IN_ORIGINAL_ORDER, Boolean.FALSE);</span>
<span class="fc" id="L542">        defaults.put(EXPORT_IN_SPECIFIED_ORDER, Boolean.FALSE);</span>

        // export order: if EXPORT_IN_SPECIFIED_ORDER, then use following criteria
<span class="fc" id="L545">        defaults.put(EXPORT_PRIMARY_SORT_FIELD, &quot;bibtexkey&quot;);</span>
<span class="fc" id="L546">        defaults.put(EXPORT_PRIMARY_SORT_DESCENDING, Boolean.FALSE);</span>
<span class="fc" id="L547">        defaults.put(EXPORT_SECONDARY_SORT_FIELD, &quot;author&quot;);</span>
<span class="fc" id="L548">        defaults.put(EXPORT_SECONDARY_SORT_DESCENDING, Boolean.FALSE);</span>
<span class="fc" id="L549">        defaults.put(EXPORT_TERTIARY_SORT_FIELD, &quot;title&quot;);</span>
<span class="fc" id="L550">        defaults.put(EXPORT_TERTIARY_SORT_DESCENDING, Boolean.TRUE);</span>

<span class="fc" id="L552">        defaults.put(NEWLINE, System.lineSeparator());</span>

<span class="fc" id="L554">        defaults.put(SIDE_PANE_COMPONENT_NAMES, &quot;&quot;);</span>
<span class="fc" id="L555">        defaults.put(SIDE_PANE_COMPONENT_PREFERRED_POSITIONS, &quot;&quot;);</span>

<span class="fc" id="L557">        defaults.put(COLUMN_NAMES, &quot;entrytype;author/editor;title;year;journal/booktitle;bibtexkey&quot;);</span>
<span class="fc" id="L558">        defaults.put(COLUMN_WIDTHS, &quot;75;300;470;60;130;100&quot;);</span>
<span class="fc" id="L559">        defaults.put(PersistenceTableColumnListener.ACTIVATE_PREF_KEY,</span>
<span class="fc" id="L560">                PersistenceTableColumnListener.DEFAULT_ENABLED);</span>
<span class="fc" id="L561">        defaults.put(XMP_PRIVACY_FILTERS, &quot;pdf;timestamp;keywords;owner;note;review&quot;);</span>
<span class="fc" id="L562">        defaults.put(USE_XMP_PRIVACY_FILTER, Boolean.FALSE);</span>
<span class="fc" id="L563">        defaults.put(NUMBER_COL_WIDTH, GUIGlobals.NUMBER_COL_LENGTH);</span>
<span class="fc" id="L564">        defaults.put(WORKING_DIRECTORY, USER_HOME);</span>
<span class="fc" id="L565">        defaults.put(EXPORT_WORKING_DIRECTORY, USER_HOME);</span>
        // Remembers working directory of last import
<span class="fc" id="L567">        defaults.put(IMPORT_WORKING_DIRECTORY, USER_HOME);</span>
<span class="fc" id="L568">        defaults.put(FILE_WORKING_DIRECTORY, USER_HOME);</span>
<span class="fc" id="L569">        defaults.put(AUTO_OPEN_FORM, Boolean.TRUE);</span>
<span class="fc" id="L570">        defaults.put(BACKUP, Boolean.TRUE);</span>
<span class="fc" id="L571">        defaults.put(OPEN_LAST_EDITED, Boolean.TRUE);</span>
<span class="fc" id="L572">        defaults.put(LAST_EDITED, &quot;&quot;);</span>
<span class="fc" id="L573">        defaults.put(LAST_FOCUSED, &quot;&quot;);</span>
<span class="fc" id="L574">        defaults.put(STRINGS_POS_X, 0);</span>
<span class="fc" id="L575">        defaults.put(STRINGS_POS_Y, 0);</span>
<span class="fc" id="L576">        defaults.put(STRINGS_SIZE_X, 600);</span>
<span class="fc" id="L577">        defaults.put(STRINGS_SIZE_Y, 400);</span>
<span class="fc" id="L578">        defaults.put(DUPLICATES_POS_X, 0);</span>
<span class="fc" id="L579">        defaults.put(DUPLICATES_POS_Y, 0);</span>
<span class="fc" id="L580">        defaults.put(DUPLICATES_SIZE_X, 800);</span>
<span class="fc" id="L581">        defaults.put(DUPLICATES_SIZE_Y, 600);</span>
<span class="fc" id="L582">        defaults.put(MERGEENTRIES_POS_X, 0);</span>
<span class="fc" id="L583">        defaults.put(MERGEENTRIES_POS_Y, 0);</span>
<span class="fc" id="L584">        defaults.put(MERGEENTRIES_SIZE_X, 800);</span>
<span class="fc" id="L585">        defaults.put(MERGEENTRIES_SIZE_Y, 600);</span>
<span class="fc" id="L586">        defaults.put(PREAMBLE_POS_X, 0);</span>
<span class="fc" id="L587">        defaults.put(PREAMBLE_POS_Y, 0);</span>
<span class="fc" id="L588">        defaults.put(PREAMBLE_SIZE_X, 600);</span>
<span class="fc" id="L589">        defaults.put(PREAMBLE_SIZE_Y, 400);</span>
<span class="fc" id="L590">        defaults.put(DEFAULT_SHOW_SOURCE, Boolean.FALSE);</span>
<span class="fc" id="L591">        defaults.put(DEFAULT_AUTO_SORT, Boolean.FALSE);</span>
<span class="fc" id="L592">        defaults.put(SEARCH_CASE_SENSITIVE, Boolean.FALSE);</span>
<span class="fc" id="L593">        defaults.put(SEARCH_MODE_FILTER, Boolean.TRUE);</span>

<span class="fc" id="L595">        defaults.put(SEARCH_REG_EXP, Boolean.FALSE);</span>
<span class="fc" id="L596">        defaults.put(SEARCH_PANE_POS_X, 0);</span>
<span class="fc" id="L597">        defaults.put(SEARCH_PANE_POS_Y, 0);</span>

<span class="fc" id="L599">        defaults.put(MERGE_ENTRIES_DIFF_MODE, 2);</span>

<span class="fc" id="L601">        defaults.put(EDITOR_EMACS_KEYBINDINGS, Boolean.FALSE);</span>
<span class="fc" id="L602">        defaults.put(EDITOR_EMACS_KEYBINDINGS_REBIND_CA, Boolean.TRUE);</span>
<span class="fc" id="L603">        defaults.put(EDITOR_EMACS_KEYBINDINGS_REBIND_CF, Boolean.TRUE);</span>
<span class="fc" id="L604">        defaults.put(AUTO_COMPLETE, Boolean.TRUE);</span>
<span class="fc" id="L605">        AutoCompletePreferences.putDefaults(defaults);</span>
<span class="fc" id="L606">        defaults.put(GROUP_FLOAT_SELECTIONS, Boolean.TRUE);</span>
<span class="fc" id="L607">        defaults.put(GROUP_INTERSECT_SELECTIONS, Boolean.TRUE);</span>
<span class="fc" id="L608">        defaults.put(GROUP_INVERT_SELECTIONS, Boolean.FALSE);</span>
<span class="fc" id="L609">        defaults.put(GROUP_SHOW_OVERLAPPING, Boolean.FALSE);</span>
<span class="fc" id="L610">        defaults.put(GROUP_SELECT_MATCHES, Boolean.FALSE);</span>
<span class="fc" id="L611">        defaults.put(GROUPS_DEFAULT_FIELD, &quot;keywords&quot;);</span>
<span class="fc" id="L612">        defaults.put(GROUP_SHOW_ICONS, Boolean.TRUE);</span>
<span class="fc" id="L613">        defaults.put(GROUP_SHOW_DYNAMIC, Boolean.TRUE);</span>
<span class="fc" id="L614">        defaults.put(GROUP_EXPAND_TREE, Boolean.TRUE);</span>
<span class="fc" id="L615">        defaults.put(GROUP_AUTO_SHOW, Boolean.TRUE);</span>
<span class="fc" id="L616">        defaults.put(GROUP_AUTO_HIDE, Boolean.TRUE);</span>
<span class="fc" id="L617">        defaults.put(GROUP_SHOW_NUMBER_OF_ELEMENTS, Boolean.FALSE);</span>
<span class="fc" id="L618">        defaults.put(AUTO_ASSIGN_GROUP, Boolean.TRUE);</span>
<span class="fc" id="L619">        defaults.put(GROUP_KEYWORD_SEPARATOR, &quot;, &quot;);</span>
<span class="fc" id="L620">        defaults.put(EDIT_GROUP_MEMBERSHIP_MODE, Boolean.FALSE);</span>
<span class="fc" id="L621">        defaults.put(HIGHLIGHT_GROUPS_MATCHING, &quot;&quot;);</span>
<span class="fc" id="L622">        defaults.put(TOOLBAR_VISIBLE, Boolean.TRUE);</span>
<span class="fc" id="L623">        defaults.put(DEFAULT_ENCODING, StandardCharsets.UTF_8.name());</span>
<span class="fc" id="L624">        defaults.put(GROUPS_VISIBLE_ROWS, 8);</span>
<span class="fc" id="L625">        defaults.put(DEFAULT_OWNER, System.getProperty(&quot;user.name&quot;));</span>
<span class="fc" id="L626">        defaults.put(MEMORY_STICK_MODE, Boolean.FALSE);</span>
<span class="fc" id="L627">        defaults.put(RENAME_ON_MOVE_FILE_TO_FILE_DIR, Boolean.TRUE);</span>

        // The general fields stuff is made obsolete by the CUSTOM_TAB_... entries.
<span class="fc" id="L630">        defaults.put(GENERAL_FIELDS, &quot;crossref;keywords;file;doi;url;urldate;&quot;</span>
                + &quot;pdf;comment;owner&quot;);

<span class="fc" id="L633">        defaults.put(FONT_STYLE, java.awt.Font.PLAIN);</span>
<span class="fc" id="L634">        defaults.put(FONT_SIZE, 12);</span>
<span class="fc" id="L635">        defaults.put(OVERRIDE_DEFAULT_FONTS, Boolean.FALSE);</span>
<span class="fc" id="L636">        defaults.put(MENU_FONT_SIZE, 11);</span>
<span class="fc" id="L637">        defaults.put(TABLE_ROW_PADDING, GUIGlobals.TABLE_ROW_PADDING);</span>
<span class="fc" id="L638">        defaults.put(TABLE_SHOW_GRID, Boolean.FALSE);</span>
        // Main table color settings:
<span class="fc" id="L640">        defaults.put(TABLE_BACKGROUND, &quot;255:255:255&quot;);</span>
<span class="fc" id="L641">        defaults.put(TABLE_REQ_FIELD_BACKGROUND, &quot;230:235:255&quot;);</span>
<span class="fc" id="L642">        defaults.put(TABLE_OPT_FIELD_BACKGROUND, &quot;230:255:230&quot;);</span>
<span class="fc" id="L643">        defaults.put(TABLE_TEXT, &quot;0:0:0&quot;);</span>
<span class="fc" id="L644">        defaults.put(GRID_COLOR, &quot;210:210:210&quot;);</span>
<span class="fc" id="L645">        defaults.put(GRAYED_OUT_BACKGROUND, &quot;210:210:210&quot;);</span>
<span class="fc" id="L646">        defaults.put(GRAYED_OUT_TEXT, &quot;40:40:40&quot;);</span>
<span class="fc" id="L647">        defaults.put(VERY_GRAYED_OUT_BACKGROUND, &quot;180:180:180&quot;);</span>
<span class="fc" id="L648">        defaults.put(VERY_GRAYED_OUT_TEXT, &quot;40:40:40&quot;);</span>
<span class="fc" id="L649">        defaults.put(MARKED_ENTRY_BACKGROUND0, &quot;255:255:180&quot;);</span>
<span class="fc" id="L650">        defaults.put(MARKED_ENTRY_BACKGROUND1, &quot;255:220:180&quot;);</span>
<span class="fc" id="L651">        defaults.put(MARKED_ENTRY_BACKGROUND2, &quot;255:180:160&quot;);</span>
<span class="fc" id="L652">        defaults.put(MARKED_ENTRY_BACKGROUND3, &quot;255:120:120&quot;);</span>
<span class="fc" id="L653">        defaults.put(MARKED_ENTRY_BACKGROUND4, &quot;255:75:75&quot;);</span>
<span class="fc" id="L654">        defaults.put(MARKED_ENTRY_BACKGROUND5, &quot;220:255:220&quot;);</span>
<span class="fc" id="L655">        defaults.put(VALID_FIELD_BACKGROUND_COLOR, &quot;255:255:255&quot;);</span>
<span class="fc" id="L656">        defaults.put(INVALID_FIELD_BACKGROUND_COLOR, &quot;255:0:0&quot;);</span>
<span class="fc" id="L657">        defaults.put(ACTIVE_FIELD_EDITOR_BACKGROUND_COLOR, &quot;220:220:255&quot;);</span>
<span class="fc" id="L658">        defaults.put(FIELD_EDITOR_TEXT_COLOR, &quot;0:0:0&quot;);</span>

<span class="fc" id="L660">        defaults.put(INCOMPLETE_ENTRY_BACKGROUND, &quot;250:175:175&quot;);</span>

<span class="fc" id="L662">        defaults.put(CTRL_CLICK, Boolean.FALSE);</span>
<span class="fc" id="L663">        defaults.put(DISABLE_ON_MULTIPLE_SELECTION, Boolean.FALSE);</span>
<span class="fc" id="L664">        defaults.put(URL_COLUMN, Boolean.TRUE);</span>
<span class="fc" id="L665">        defaults.put(PREFER_URL_DOI, Boolean.FALSE);</span>
<span class="fc" id="L666">        defaults.put(FILE_COLUMN, Boolean.TRUE);</span>
<span class="fc" id="L667">        defaults.put(ARXIV_COLUMN, Boolean.FALSE);</span>

<span class="fc" id="L669">        defaults.put(EXTRA_FILE_COLUMNS, Boolean.FALSE);</span>
<span class="fc" id="L670">        defaults.put(LIST_OF_FILE_COLUMNS, &quot;&quot;);</span>

        // OpenOffice/LibreOffice
<span class="pc bpc" id="L673" title="1 of 2 branches missed.">        if (OS.WINDOWS) {</span>
<span class="nc" id="L674">            defaults.put(JabRefPreferences.OO_PATH, OpenOfficePreferences.DEFAULT_WINDOWS_PATH);</span>
<span class="nc" id="L675">            defaults.put(JabRefPreferences.OO_EXECUTABLE_PATH, OpenOfficePreferences.DEFAULT_WINDOWS_PATH</span>
                    + OpenOfficePreferences.WINDOWS_EXECUTABLE_SUBPATH + OpenOfficePreferences.WINDOWS_EXECUTABLE);
<span class="nc" id="L677">            defaults.put(JabRefPreferences.OO_JARS_PATH,</span>
<span class="nc" id="L678">                    OpenOfficePreferences.DEFAULT_WINDOWS_PATH + OpenOfficePreferences.WINDOWS_JARS_SUBPATH);</span>
<span class="pc bpc" id="L679" title="1 of 2 branches missed.">        } else if (OS.OS_X) {</span>
<span class="nc" id="L680">            defaults.put(JabRefPreferences.OO_PATH, OpenOfficePreferences.DEFAULT_OSX_PATH);</span>
<span class="nc" id="L681">            defaults.put(JabRefPreferences.OO_EXECUTABLE_PATH, OpenOfficePreferences.DEFAULT_OSX_PATH</span>
                    + OpenOfficePreferences.OSX_EXECUTABLE_SUBPATH + OpenOfficePreferences.OSX_EXECUTABLE);
<span class="nc" id="L683">            defaults.put(JabRefPreferences.OO_JARS_PATH,</span>
<span class="nc" id="L684">                    OpenOfficePreferences.DEFAULT_OSX_PATH + OpenOfficePreferences.OSX_JARS_SUBPATH);</span>
<span class="nc" id="L685">        } else { // Linux</span>
<span class="fc" id="L686">            defaults.put(JabRefPreferences.OO_PATH, &quot;/opt/openoffice.org3&quot;);</span>
<span class="fc" id="L687">            defaults.put(JabRefPreferences.OO_EXECUTABLE_PATH, &quot;/usr/lib/openoffice/program/soffice&quot;);</span>
<span class="fc" id="L688">            defaults.put(JabRefPreferences.OO_JARS_PATH, &quot;/opt/openoffice.org/basis3.0&quot;);</span>
        }

<span class="fc" id="L691">        defaults.put(JabRefPreferences.OO_SYNC_WHEN_CITING, false);</span>
<span class="fc" id="L692">        defaults.put(JabRefPreferences.OO_SHOW_PANEL, false);</span>
<span class="fc" id="L693">        defaults.put(JabRefPreferences.OO_USE_ALL_OPEN_BASES, true);</span>
<span class="fc" id="L694">        defaults.put(JabRefPreferences.OO_BIBLIOGRAPHY_STYLE_FILE,</span>
<span class="fc" id="L695">                StyleLoader.DEFAULT_AUTHORYEAR_STYLE_PATH);</span>
<span class="fc" id="L696">        defaults.put(JabRefPreferences.OO_EXTERNAL_STYLE_FILES, &quot;&quot;);</span>
<span class="fc" id="L697">        defaults.put(STYLES_POS_X, 0);</span>
<span class="fc" id="L698">        defaults.put(STYLES_POS_Y, 0);</span>
<span class="fc" id="L699">        defaults.put(STYLES_SIZE_X, 600);</span>
<span class="fc" id="L700">        defaults.put(STYLES_SIZE_Y, 400);</span>

<span class="fc" id="L702">        defaults.put(SpecialFieldsUtils.PREF_SPECIALFIELDSENABLED, SpecialFieldsUtils.PREF_SPECIALFIELDSENABLED_DEFAULT);</span>
<span class="fc" id="L703">        defaults.put(SpecialFieldsUtils.PREF_SHOWCOLUMN_PRIORITY, SpecialFieldsUtils.PREF_SHOWCOLUMN_PRIORITY_DEFAULT);</span>
<span class="fc" id="L704">        defaults.put(SpecialFieldsUtils.PREF_SHOWCOLUMN_QUALITY, SpecialFieldsUtils.PREF_SHOWCOLUMN_QUALITY_DEFAULT);</span>
<span class="fc" id="L705">        defaults.put(SpecialFieldsUtils.PREF_SHOWCOLUMN_RANKING, SpecialFieldsUtils.PREF_SHOWCOLUMN_RANKING_DEFAULT);</span>
<span class="fc" id="L706">        defaults.put(SpecialFieldsUtils.PREF_SHOWCOLUMN_RELEVANCE, SpecialFieldsUtils.PREF_SHOWCOLUMN_RELEVANCE_DEFAULT);</span>
<span class="fc" id="L707">        defaults.put(SpecialFieldsUtils.PREF_SHOWCOLUMN_PRINTED, SpecialFieldsUtils.PREF_SHOWCOLUMN_PRINTED_DEFAULT);</span>
<span class="fc" id="L708">        defaults.put(SpecialFieldsUtils.PREF_SHOWCOLUMN_READ, SpecialFieldsUtils.PREF_SHOWCOLUMN_READ_DEFAULT);</span>
<span class="fc" id="L709">        defaults.put(SpecialFieldsUtils.PREF_AUTOSYNCSPECIALFIELDSTOKEYWORDS, SpecialFieldsUtils.PREF_AUTOSYNCSPECIALFIELDSTOKEYWORDS_DEFAULT);</span>
<span class="fc" id="L710">        defaults.put(SpecialFieldsUtils.PREF_SERIALIZESPECIALFIELDS, SpecialFieldsUtils.PREF_SERIALIZESPECIALFIELDS_DEFAULT);</span>

<span class="fc" id="L712">        defaults.put(USE_OWNER, Boolean.FALSE);</span>
<span class="fc" id="L713">        defaults.put(OVERWRITE_OWNER, Boolean.FALSE);</span>
<span class="fc" id="L714">        defaults.put(DIALOG_WARNING_FOR_DUPLICATE_KEY, Boolean.TRUE);</span>
<span class="fc" id="L715">        defaults.put(DIALOG_WARNING_FOR_EMPTY_KEY, Boolean.TRUE);</span>
<span class="fc" id="L716">        defaults.put(DISPLAY_KEY_WARNING_DIALOG_AT_STARTUP, Boolean.TRUE);</span>
<span class="fc" id="L717">        defaults.put(AVOID_OVERWRITING_KEY, Boolean.FALSE);</span>
<span class="fc" id="L718">        defaults.put(WARN_BEFORE_OVERWRITING_KEY, Boolean.TRUE);</span>
<span class="fc" id="L719">        defaults.put(CONFIRM_DELETE, Boolean.TRUE);</span>
<span class="fc" id="L720">        defaults.put(GRAY_OUT_NON_HITS, Boolean.TRUE);</span>
<span class="fc" id="L721">        defaults.put(SEARCH_MODE_FLOAT, Boolean.FALSE);</span>
<span class="fc" id="L722">        defaults.put(DEFAULT_LABEL_PATTERN, &quot;[authors3][year]&quot;);</span>
<span class="fc" id="L723">        defaults.put(PREVIEW_ENABLED, Boolean.TRUE);</span>
<span class="fc" id="L724">        defaults.put(ACTIVE_PREVIEW, 0);</span>
<span class="fc" id="L725">        defaults.put(PREVIEW_0,</span>
<span class="fc" id="L726">                &quot;&lt;font face=\&quot;sans-serif\&quot;&gt;&quot;</span>
                + &quot;&lt;b&gt;&lt;i&gt;\\bibtextype&lt;/i&gt;&lt;a name=\&quot;\\bibtexkey\&quot;&gt;\\begin{bibtexkey} (\\bibtexkey)&lt;/a&gt;&quot;
                + &quot;\\end{bibtexkey}&lt;/b&gt;&lt;br&gt;__NEWLINE__&quot;
                + &quot;\\begin{author} \\format[Authors(LastFirst,Initials,Semicolon,Amp),HTMLChars]{\\author}&lt;BR&gt;\\end{author}__NEWLINE__&quot;
                + &quot;\\begin{editor} \\format[Authors(LastFirst,Initials,Semicolon,Amp),HTMLChars]{\\editor} &quot;
                + &quot;&lt;i&gt;(\\format[IfPlural(Eds.,Ed.)]{\\editor})&lt;/i&gt;&lt;BR&gt;\\end{editor}__NEWLINE__&quot;
                + &quot;\\begin{title} \\format[HTMLChars]{\\title} \\end{title}&lt;BR&gt;__NEWLINE__&quot;
                + &quot;\\begin{chapter} \\format[HTMLChars]{\\chapter}&lt;BR&gt;\\end{chapter}__NEWLINE__&quot;
                + &quot;\\begin{journal} &lt;em&gt;\\format[HTMLChars]{\\journal}, &lt;/em&gt;\\end{journal}__NEWLINE__&quot;
                // Include the booktitle field for @inproceedings, @proceedings, etc.
                + &quot;\\begin{booktitle} &lt;em&gt;\\format[HTMLChars]{\\booktitle}, &lt;/em&gt;\\end{booktitle}__NEWLINE__&quot;
                + &quot;\\begin{school} &lt;em&gt;\\format[HTMLChars]{\\school}, &lt;/em&gt;\\end{school}__NEWLINE__&quot;
                + &quot;\\begin{institution} &lt;em&gt;\\format[HTMLChars]{\\institution}, &lt;/em&gt;\\end{institution}__NEWLINE__&quot;
                + &quot;\\begin{publisher} &lt;em&gt;\\format[HTMLChars]{\\publisher}, &lt;/em&gt;\\end{publisher}__NEWLINE__&quot;
                + &quot;\\begin{year}&lt;b&gt;\\year&lt;/b&gt;\\end{year}\\begin{volume}&lt;i&gt;, \\volume&lt;/i&gt;\\end{volume}&quot;
                + &quot;\\begin{pages}, \\format[FormatPagesForHTML]{\\pages} \\end{pages}__NEWLINE__&quot;
                + &quot;\\begin{abstract}&lt;BR&gt;&lt;BR&gt;&lt;b&gt;Abstract: &lt;/b&gt; \\format[HTMLChars]{\\abstract} \\end{abstract}__NEWLINE__&quot;
                + &quot;\\begin{review}&lt;BR&gt;&lt;BR&gt;&lt;b&gt;Review: &lt;/b&gt; \\format[HTMLChars]{\\review} \\end{review}&quot;
                + &quot;&lt;/dd&gt;__NEWLINE__&lt;p&gt;&lt;/p&gt;&lt;/font&gt;&quot;);
<span class="fc" id="L745">        defaults.put(PREVIEW_1,</span>
<span class="fc" id="L746">                &quot;&lt;font face=\&quot;sans-serif\&quot;&gt;&quot;</span>
                + &quot;&lt;b&gt;&lt;i&gt;\\bibtextype&lt;/i&gt;&lt;a name=\&quot;\\bibtexkey\&quot;&gt;\\begin{bibtexkey} (\\bibtexkey)&lt;/a&gt;&quot;
                + &quot;\\end{bibtexkey}&lt;/b&gt;&lt;br&gt;__NEWLINE__&quot;
                + &quot;\\begin{author} \\format[Authors(LastFirst,Initials,Semicolon,Amp),HTMLChars]{\\author}&lt;BR&gt;\\end{author}__NEWLINE__&quot;
                + &quot;\\begin{editor} \\format[Authors(LastFirst,Initials,Semicolon,Amp),HTMLChars]{\\editor} &quot;
                + &quot;&lt;i&gt;(\\format[IfPlural(Eds.,Ed.)]{\\editor})&lt;/i&gt;&lt;BR&gt;\\end{editor}__NEWLINE__&quot;
                + &quot;\\begin{title} \\format[HTMLChars]{\\title} \\end{title}&lt;BR&gt;__NEWLINE__&quot;
                + &quot;\\begin{chapter} \\format[HTMLChars]{\\chapter}&lt;BR&gt;\\end{chapter}__NEWLINE__&quot;
                + &quot;\\begin{journal} &lt;em&gt;\\format[HTMLChars]{\\journal}, &lt;/em&gt;\\end{journal}__NEWLINE__&quot;
                // Include the booktitle field for @inproceedings, @proceedings, etc.
                + &quot;\\begin{booktitle} &lt;em&gt;\\format[HTMLChars]{\\booktitle}, &lt;/em&gt;\\end{booktitle}__NEWLINE__&quot;
                + &quot;\\begin{school} &lt;em&gt;\\format[HTMLChars]{\\school}, &lt;/em&gt;\\end{school}__NEWLINE__&quot;
                + &quot;\\begin{institution} &lt;em&gt;\\format[HTMLChars]{\\institution}, &lt;/em&gt;\\end{institution}__NEWLINE__&quot;
                + &quot;\\begin{publisher} &lt;em&gt;\\format[HTMLChars]{\\publisher}, &lt;/em&gt;\\end{publisher}__NEWLINE__&quot;
                + &quot;\\begin{year}&lt;b&gt;\\year&lt;/b&gt;\\end{year}\\begin{volume}&lt;i&gt;, \\volume&lt;/i&gt;\\end{volume}&quot;
                + &quot;\\begin{pages}, \\format[FormatPagesForHTML]{\\pages} \\end{pages}&quot;
                + &quot;&lt;/dd&gt;__NEWLINE__&lt;p&gt;&lt;/p&gt;&lt;/font&gt;&quot;);

        // TODO: Currently not possible to edit this setting:
<span class="fc" id="L765">        defaults.put(PREVIEW_PRINT_BUTTON, Boolean.FALSE);</span>
<span class="fc" id="L766">        defaults.put(DO_NOT_RESOLVE_STRINGS_FOR, &quot;url&quot;);</span>
<span class="fc" id="L767">        defaults.put(RESOLVE_STRINGS_ALL_FIELDS, Boolean.FALSE);</span>
<span class="fc" id="L768">        defaults.put(PUT_BRACES_AROUND_CAPITALS, &quot;&quot;);//&quot;title;journal;booktitle;review;abstract&quot;);</span>
<span class="fc" id="L769">        defaults.put(NON_WRAPPABLE_FIELDS, &quot;pdf;ps;url;doi;file&quot;);</span>
<span class="fc" id="L770">        defaults.put(GENERATE_KEYS_AFTER_INSPECTION, Boolean.TRUE);</span>
<span class="fc" id="L771">        defaults.put(MARK_IMPORTED_ENTRIES, Boolean.TRUE);</span>
<span class="fc" id="L772">        defaults.put(UNMARK_ALL_ENTRIES_BEFORE_IMPORTING, Boolean.TRUE);</span>
<span class="fc" id="L773">        defaults.put(WARN_ABOUT_DUPLICATES_IN_INSPECTION, Boolean.TRUE);</span>
<span class="fc" id="L774">        defaults.put(USE_TIME_STAMP, Boolean.FALSE);</span>
<span class="fc" id="L775">        defaults.put(OVERWRITE_TIME_STAMP, Boolean.FALSE);</span>

        // default time stamp follows ISO-8601. Reason: https://xkcd.com/1179/
<span class="fc" id="L778">        defaults.put(TIME_STAMP_FORMAT, &quot;yyyy-MM-dd&quot;);</span>

<span class="fc" id="L780">        defaults.put(TIME_STAMP_FIELD, InternalBibtexFields.TIMESTAMP);</span>
<span class="fc" id="L781">        defaults.put(UPDATE_TIMESTAMP, Boolean.FALSE);</span>

<span class="fc" id="L783">        defaults.put(GENERATE_KEYS_BEFORE_SAVING, Boolean.FALSE);</span>

<span class="fc" id="L785">        defaults.put(RemotePreferences.USE_REMOTE_SERVER, Boolean.TRUE);</span>
<span class="fc" id="L786">        defaults.put(RemotePreferences.REMOTE_SERVER_PORT, 6970);</span>

<span class="fc" id="L788">        defaults.put(PERSONAL_JOURNAL_LIST, &quot;&quot;);</span>
<span class="fc" id="L789">        defaults.put(EXTERNAL_JOURNAL_LISTS, &quot;&quot;);</span>
<span class="fc" id="L790">        defaults.put(CITE_COMMAND, &quot;\\cite&quot;); // obsoleted by the app-specific ones (not any more?)</span>
<span class="fc" id="L791">        defaults.put(FLOAT_MARKED_ENTRIES, Boolean.TRUE);</span>

<span class="fc" id="L793">        defaults.put(LAST_USED_EXPORT, &quot;&quot;);</span>
<span class="fc" id="L794">        defaults.put(SIDE_PANE_WIDTH, -1);</span>

<span class="fc" id="L796">        defaults.put(IMPORT_INSPECTION_DIALOG_WIDTH, 650);</span>
<span class="fc" id="L797">        defaults.put(IMPORT_INSPECTION_DIALOG_HEIGHT, 650);</span>
<span class="fc" id="L798">        defaults.put(SEARCH_DIALOG_WIDTH, 650);</span>
<span class="fc" id="L799">        defaults.put(SEARCH_DIALOG_HEIGHT, 500);</span>
<span class="fc" id="L800">        defaults.put(SHOW_FILE_LINKS_UPGRADE_WARNING, Boolean.TRUE);</span>
<span class="fc" id="L801">        defaults.put(AUTOLINK_EXACT_KEY_ONLY, Boolean.FALSE);</span>
<span class="fc" id="L802">        defaults.put(NUMERIC_FIELDS, &quot;mittnum;author&quot;);</span>
<span class="fc" id="L803">        defaults.put(RUN_AUTOMATIC_FILE_SEARCH, Boolean.FALSE);</span>
<span class="fc" id="L804">        defaults.put(USE_LOCK_FILES, Boolean.TRUE);</span>
<span class="fc" id="L805">        defaults.put(AUTO_SAVE, Boolean.TRUE);</span>
<span class="fc" id="L806">        defaults.put(AUTO_SAVE_INTERVAL, 5);</span>
<span class="fc" id="L807">        defaults.put(PROMPT_BEFORE_USING_AUTOSAVE, Boolean.TRUE);</span>
<span class="fc" id="L808">        defaults.put(ENFORCE_LEGAL_BIBTEX_KEY, Boolean.TRUE);</span>
        // Curly brackets ({}) are the default delimiters, not quotes (&quot;) as these cause trouble when they appear within the field value:
        // Currently, JabRef does not escape them
<span class="fc" id="L811">        defaults.put(VALUE_DELIMITERS2, 1);</span>
<span class="fc" id="L812">        defaults.put(KEY_GEN_FIRST_LETTER_A, Boolean.TRUE);</span>
<span class="fc" id="L813">        defaults.put(KEY_GEN_ALWAYS_ADD_LETTER, Boolean.FALSE);</span>
<span class="fc" id="L814">        defaults.put(EMAIL_SUBJECT, Localization.lang(&quot;References&quot;));</span>
<span class="fc" id="L815">        defaults.put(OPEN_FOLDERS_OF_ATTACHED_FILES, Boolean.FALSE);</span>
<span class="fc" id="L816">        defaults.put(ALLOW_FILE_AUTO_OPEN_BROWSE, Boolean.TRUE);</span>
<span class="fc" id="L817">        defaults.put(WEB_SEARCH_VISIBLE, Boolean.FALSE);</span>
<span class="fc" id="L818">        defaults.put(SELECTED_FETCHER_INDEX, 0);</span>
<span class="fc" id="L819">        defaults.put(BIB_LOC_AS_PRIMARY_DIR, Boolean.FALSE);</span>
<span class="fc" id="L820">        defaults.put(DB_CONNECT_SERVER_TYPE, &quot;MySQL&quot;);</span>
<span class="fc" id="L821">        defaults.put(DB_CONNECT_HOSTNAME, &quot;localhost&quot;);</span>
<span class="fc" id="L822">        defaults.put(DB_CONNECT_DATABASE, &quot;jabref&quot;);</span>
<span class="fc" id="L823">        defaults.put(DB_CONNECT_USERNAME, &quot;root&quot;);</span>

<span class="fc" id="L825">        defaults.put(AKS_AUTO_NAMING_PDFS_AGAIN, Boolean.TRUE);</span>
<span class="fc" id="L826">        insertCleanupPreset(defaults, CLEANUP_DEFAULT_PRESET);</span>

        // defaults for DroppedFileHandler UI
<span class="fc" id="L829">        defaults.put(DroppedFileHandler.DFH_LEAVE, Boolean.FALSE);</span>
<span class="fc" id="L830">        defaults.put(DroppedFileHandler.DFH_COPY, Boolean.TRUE);</span>
<span class="fc" id="L831">        defaults.put(DroppedFileHandler.DFH_MOVE, Boolean.FALSE);</span>
<span class="fc" id="L832">        defaults.put(DroppedFileHandler.DFH_RENAME, Boolean.FALSE);</span>

        //defaults.put(&quot;lastAutodetectedImport&quot;, &quot;&quot;);
        //defaults.put(&quot;autoRemoveExactDuplicates&quot;, Boolean.FALSE);
        //defaults.put(&quot;confirmAutoRemoveExactDuplicates&quot;, Boolean.TRUE);
        //defaults.put(&quot;tempDir&quot;, System.getProperty(&quot;java.io.tmpdir&quot;));
<span class="fc" id="L838">        LOGGER.debug(&quot;Temporary directory: &quot; + System.getProperty(&quot;java.io.tempdir&quot;));</span>
        //defaults.put(&quot;keyPattern&quot;, new LabelPattern(KEY_PATTERN));

<span class="fc" id="L841">        defaults.put(PREF_IMPORT_ALWAYSUSE, Boolean.FALSE);</span>
<span class="fc" id="L842">        defaults.put(PREF_IMPORT_DEFAULT_PDF_IMPORT_STYLE, ImportSettingsTab.DEFAULT_STYLE);</span>

        // use BibTeX key appended with filename as default pattern
<span class="fc" id="L845">        defaults.put(PREF_IMPORT_FILENAMEPATTERN, ImportSettingsTab.DEFAULT_FILENAMEPATTERNS[1]);</span>

<span class="fc" id="L847">        customExports = new CustomExportList(new ExportComparator());</span>
<span class="fc" id="L848">        customImports = new CustomImportList(this);</span>

<span class="fc" id="L850">        updateSpecialFieldHandling();</span>
<span class="fc" id="L851">        WRAPPED_USERNAME = '[' + get(DEFAULT_OWNER) + ']';</span>
<span class="fc" id="L852">        MARKING_WITH_NUMBER_PATTERN = &quot;\\[&quot; + get(DEFAULT_OWNER).replaceAll(&quot;\\\\&quot;, &quot;\\\\\\\\&quot;) + &quot;:(\\d+)\\]&quot;;</span>

<span class="fc" id="L854">        String defaultExpression = &quot;**/.*[bibtexkey].*\\\\.[extension]&quot;;</span>
<span class="fc" id="L855">        defaults.put(DEFAULT_REG_EXP_SEARCH_EXPRESSION_KEY, defaultExpression);</span>
<span class="fc" id="L856">        defaults.put(REG_EXP_SEARCH_EXPRESSION_KEY, defaultExpression);</span>
<span class="fc" id="L857">        defaults.put(AUTOLINK_USE_REG_EXP_SEARCH_KEY, Boolean.FALSE);</span>
<span class="fc" id="L858">        defaults.put(USE_IEEE_ABRV, Boolean.FALSE);</span>
<span class="fc" id="L859">        defaults.put(USE_CONVERT_TO_EQUATION, Boolean.FALSE);</span>
<span class="fc" id="L860">        defaults.put(USE_CASE_KEEPER_ON_SEARCH, Boolean.TRUE);</span>
<span class="fc" id="L861">        defaults.put(USE_UNIT_FORMATTER_ON_SEARCH, Boolean.TRUE);</span>
<span class="fc" id="L862">    }</span>

    public String getUser() {
        try {
<span class="nc" id="L866">            return get(DEFAULT_OWNER) + '-' + InetAddress.getLocalHost().getHostName();</span>
<span class="nc" id="L867">        } catch (UnknownHostException ex) {</span>
<span class="nc" id="L868">            LOGGER.debug(&quot;Hostname not found.&quot;, ex);</span>
<span class="nc" id="L869">            return get(DEFAULT_OWNER);</span>
        }
    }

    public List&lt;String&gt; getCustomTabFieldNames() {
<span class="fc" id="L874">        List&lt;String&gt; customFields = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L876">        int defNumber = 0;</span>
<span class="fc" id="L877">        while(true) {</span>
            // saved as CUSTOMTABNAME_def{number} and ; separated
<span class="fc" id="L879">            String fields = (String) defaults.get(CUSTOM_TAB_FIELDS + &quot;_def&quot; + defNumber);</span>

<span class="pc bpc" id="L881" title="1 of 4 branches missed.">            if((fields == null) || fields.isEmpty()) {</span>
<span class="nc" id="L882">                break;</span>
            }

<span class="fc" id="L885">            customFields.addAll(Arrays.asList(fields.split(&quot;;&quot;)));</span>
<span class="fc" id="L886">            defNumber++;</span>
        }
<span class="fc" id="L888">        return customFields;</span>
    }

    public void setLanguageDependentDefaultValues() {
        // Entry editor tab 0:
<span class="fc" id="L893">        defaults.put(CUSTOM_TAB_NAME + &quot;_def0&quot;, Localization.lang(&quot;General&quot;));</span>
<span class="fc" id="L894">        defaults.put(CUSTOM_TAB_FIELDS + &quot;_def0&quot;, &quot;crossref;keywords;file;doi;url;&quot;</span>
                + &quot;comment;owner;timestamp&quot;);

        // Entry editor tab 1:
<span class="fc" id="L898">        defaults.put(CUSTOM_TAB_FIELDS + &quot;_def1&quot;, &quot;abstract&quot;);</span>
<span class="fc" id="L899">        defaults.put(CUSTOM_TAB_NAME + &quot;_def1&quot;, Localization.lang(&quot;Abstract&quot;));</span>

        // Entry editor tab 2: Review Field - used for research comments, etc.
<span class="fc" id="L902">        defaults.put(CUSTOM_TAB_FIELDS + &quot;_def2&quot;, &quot;review&quot;);</span>
<span class="fc" id="L903">        defaults.put(CUSTOM_TAB_NAME + &quot;_def2&quot;, Localization.lang(&quot;Review&quot;));</span>

<span class="fc" id="L905">        defaults.put(EMAIL_SUBJECT, Localization.lang(&quot;References&quot;));</span>
<span class="fc" id="L906">    }</span>

    public boolean putBracesAroundCapitals(String fieldName) {
<span class="fc" id="L909">        return putBracesAroundCapitalsFields.contains(fieldName);</span>
    }

    public void updateSpecialFieldHandling() {
<span class="fc" id="L913">        putBracesAroundCapitalsFields.clear();</span>
<span class="fc" id="L914">        String fieldString = get(PUT_BRACES_AROUND_CAPITALS);</span>
<span class="pc bpc" id="L915" title="1 of 2 branches missed.">        if (!fieldString.isEmpty()) {</span>
<span class="nc" id="L916">            String[] fields = fieldString.split(&quot;;&quot;);</span>
<span class="nc bnc" id="L917" title="All 2 branches missed.">            for (String field : fields) {</span>
<span class="nc" id="L918">                putBracesAroundCapitalsFields.add(field.trim());</span>
            }
        }
<span class="fc" id="L921">        nonWrappableFields.clear();</span>
<span class="fc" id="L922">        fieldString = get(NON_WRAPPABLE_FIELDS);</span>
<span class="pc bpc" id="L923" title="1 of 2 branches missed.">        if (!fieldString.isEmpty()) {</span>
<span class="fc" id="L924">            String[] fields = fieldString.split(&quot;;&quot;);</span>
<span class="fc bfc" id="L925" title="All 2 branches covered.">            for (String field : fields) {</span>
<span class="fc" id="L926">                nonWrappableFields.add(field.trim());</span>
            }
        }

<span class="fc" id="L930">    }</span>

    public char getValueDelimiters(int index) {
<span class="fc" id="L933">        return getValueDelimiters()[index];</span>
    }

    private char[] getValueDelimiters() {
<span class="fc" id="L937">        return JabRefPreferences.VALUE_DELIMITERS[getInt(VALUE_DELIMITERS2)];</span>
    }

    /**
     * Check whether a key is set (differently from null).
     *
     * @param key The key to check.
     * @return true if the key is set, false otherwise.
     */
    public boolean hasKey(String key) {
<span class="pc bpc" id="L947" title="1 of 2 branches missed.">        return prefs.get(key, null) != null;</span>
    }

    public String get(String key) {
<span class="fc" id="L951">        return prefs.get(key, (String) defaults.get(key));</span>
    }

    public String get(String key, String def) {
<span class="fc" id="L955">        return prefs.get(key, def);</span>
    }

    public boolean getBoolean(String key) {
<span class="fc" id="L959">        return prefs.getBoolean(key, getBooleanDefault(key));</span>
    }

    public boolean getBoolean(String key, boolean def) {
<span class="fc" id="L963">        return prefs.getBoolean(key, def);</span>
    }

    private boolean getBooleanDefault(String key) {
<span class="fc" id="L967">        return (Boolean) defaults.get(key);</span>
    }

    public int getInt(String key) {
<span class="fc" id="L971">        return prefs.getInt(key, getIntDefault(key));</span>
    }

    public int getIntDefault(String key) {
<span class="fc" id="L975">        return (Integer) defaults.get(key);</span>
    }

    public void put(String key, String value) {
<span class="fc" id="L979">        prefs.put(key, value);</span>
<span class="fc" id="L980">    }</span>

    public void putBoolean(String key, boolean value) {
<span class="fc" id="L983">        prefs.putBoolean(key, value);</span>
<span class="fc" id="L984">    }</span>

    public void putInt(String key, int value) {
<span class="fc" id="L987">        prefs.putInt(key, value);</span>
<span class="fc" id="L988">    }</span>

    public void remove(String key) {
<span class="nc" id="L991">        prefs.remove(key);</span>
<span class="nc" id="L992">    }</span>

    /**
     * Puts a list of strings into the Preferences, by linking its elements with ';' into a single string. Escape
     * characters make the process transparent even if strings contain ';'.
     */
    public void putStringList(String key, List&lt;String&gt; value) {
<span class="pc bpc" id="L999" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L1000">            remove(key);</span>
<span class="nc" id="L1001">            return;</span>
        }

<span class="fc" id="L1004">        put(key, convertListToString(value));</span>
<span class="fc" id="L1005">    }</span>

    private static String convertListToString(List&lt;String&gt; value) {
<span class="fc" id="L1008">        return value.stream().map(val -&gt; StringUtil.quote(val, &quot;;&quot;, '\\')).collect(Collectors.joining(&quot;;&quot;));</span>
    }

    /**
     * Returns a List of Strings containing the chosen columns.
     */
    public List&lt;String&gt; getStringList(String key) {
<span class="fc" id="L1015">        String names = get(key);</span>
<span class="fc bfc" id="L1016" title="All 2 branches covered.">        if (names == null) {</span>
<span class="fc" id="L1017">            return new ArrayList&lt;&gt;();</span>
        }

<span class="fc" id="L1020">        StringReader rd = new StringReader(names);</span>
<span class="fc" id="L1021">        List&lt;String&gt; res = new ArrayList&lt;&gt;();</span>
        String rs;
        try {
<span class="fc bfc" id="L1024" title="All 2 branches covered.">            while ((rs = getNextUnit(rd)) != null) {</span>
<span class="fc" id="L1025">                res.add(rs);</span>
            }
<span class="pc" id="L1027">        } catch (IOException ignored) {</span>
            // Ignored
        }
<span class="fc" id="L1030">        return res;</span>
    }

    /**
     * Looks up a color definition in preferences, and returns the Color object.
     *
     * @param key The key for this setting.
     * @return The color corresponding to the setting.
     */
    public Color getColor(String key) {
<span class="fc" id="L1040">        String value = get(key);</span>
<span class="fc" id="L1041">        int[] rgb = getRgb(value);</span>
<span class="fc" id="L1042">        return new Color(rgb[0], rgb[1], rgb[2]);</span>
    }

    public Color getDefaultColor(String key) {
<span class="nc" id="L1046">        String value = (String) defaults.get(key);</span>
<span class="nc" id="L1047">        int[] rgb = getRgb(value);</span>
<span class="nc" id="L1048">        return new Color(rgb[0], rgb[1], rgb[2]);</span>
    }

    /**
     * Set the default value for a key. This is useful for plugins that need to add default values for the prefs keys
     * they use.
     *
     * @param key The preferences key.
     * @param value The default value.
     */
    public void putDefaultValue(String key, Object value) {
<span class="nc" id="L1059">        defaults.put(key, value);</span>
<span class="nc" id="L1060">    }</span>

    /**
     * Stores a color in preferences.
     *
     * @param key The key for this setting.
     * @param color The Color to store.
     */
    public void putColor(String key, Color color) {
<span class="nc" id="L1069">        String rgb = String.valueOf(color.getRed()) + ':' + color.getGreen() + ':' + color.getBlue();</span>
<span class="nc" id="L1070">        put(key, rgb);</span>
<span class="nc" id="L1071">    }</span>

    /**
     * Looks up a color definition in preferences, and returns an array containing the RGB values.
     *
     * @param value The key for this setting.
     * @return The RGB values corresponding to this color setting.
     */
    private static int[] getRgb(String value) {
<span class="fc" id="L1080">        int[] values = new int[3];</span>

<span class="pc bpc" id="L1082" title="2 of 4 branches missed.">        if ((value != null) &amp;&amp; !value.isEmpty()) {</span>
<span class="fc" id="L1083">            String[] elements = value.split(&quot;:&quot;);</span>
<span class="fc" id="L1084">            values[0] = Integer.parseInt(elements[0]);</span>
<span class="fc" id="L1085">            values[1] = Integer.parseInt(elements[1]);</span>
<span class="fc" id="L1086">            values[2] = Integer.parseInt(elements[2]);</span>
<span class="fc" id="L1087">        } else {</span>
<span class="nc" id="L1088">            values[0] = 0;</span>
<span class="nc" id="L1089">            values[1] = 0;</span>
<span class="nc" id="L1090">            values[2] = 0;</span>
        }
<span class="fc" id="L1092">        return values;</span>
    }

    /**
     * Clear all preferences.
     *
     * @throws BackingStoreException
     */
    public void clear() throws BackingStoreException {
<span class="nc" id="L1101">        prefs.clear();</span>
<span class="nc" id="L1102">    }</span>

    public void clear(String key) {
<span class="nc" id="L1105">        prefs.remove(key);</span>
<span class="nc" id="L1106">    }</span>

    /**
     * Calling this method will write all preferences into the preference store.
     */
    public void flush() {
<span class="pc bpc" id="L1112" title="1 of 2 branches missed.">        if (getBoolean(MEMORY_STICK_MODE)) {</span>
            try {
<span class="nc" id="L1114">                exportPreferences(&quot;jabref.xml&quot;);</span>
<span class="nc" id="L1115">            } catch (JabRefException e) {</span>
<span class="nc" id="L1116">                LOGGER.warn(&quot;Could not export preferences for memory stick mode: &quot; + e.getMessage(), e);</span>
            }
        }
        try {
<span class="fc" id="L1120">            prefs.flush();</span>
<span class="pc" id="L1121">        } catch (BackingStoreException ex) {</span>
<span class="nc" id="L1122">            LOGGER.warn(&quot;Can not communicate with backing store&quot;, ex);</span>
        }
<span class="fc" id="L1124">    }</span>

    /**
     * Fetches key patterns from preferences.
     * The implementation doesn't cache the results
     *
     * @return LabelPattern containing all keys. Returned LabelPattern has no parent
     */
    public GlobalLabelPattern getKeyPattern() {
<span class="nc" id="L1133">        keyPattern = new GlobalLabelPattern();</span>
<span class="nc" id="L1134">        Preferences pre = Preferences.userNodeForPackage(GlobalLabelPattern.class);</span>
        try {
<span class="nc" id="L1136">            String[] keys = pre.keys();</span>
<span class="nc bnc" id="L1137" title="All 2 branches missed.">            if (keys.length &gt; 0) {</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">                for (String key : keys) {</span>
<span class="nc" id="L1139">                    keyPattern.addLabelPattern(key, pre.get(key, null));</span>
                }
            }
<span class="nc" id="L1142">        } catch (BackingStoreException ex) {</span>
<span class="nc" id="L1143">            LOGGER.info(&quot;BackingStoreException in JabRefPreferences.getKeyPattern&quot;, ex);</span>
        }
<span class="nc" id="L1145">        return keyPattern;</span>
    }

    /**
     * Adds the given key pattern to the preferences
     *
     * @param pattern the pattern to store
     */
    public void putKeyPattern(GlobalLabelPattern pattern) {
<span class="nc" id="L1154">        keyPattern = pattern;</span>

        // Store overridden definitions to Preferences.
<span class="nc" id="L1157">        Preferences pre = Preferences.userNodeForPackage(GlobalLabelPattern.class);</span>
        try {
<span class="nc" id="L1159">            pre.clear(); // We remove all old entries.</span>
<span class="nc" id="L1160">        } catch (BackingStoreException ex) {</span>
<span class="nc" id="L1161">            LOGGER.info(&quot;BackingStoreException in JabRefPreferences.putKeyPattern&quot;, ex);</span>
        }

<span class="nc" id="L1164">        Set&lt;String&gt; allKeys = pattern.getAllKeys();</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">        for (String key : allKeys) {</span>
<span class="nc bnc" id="L1166" title="All 2 branches missed.">            if (!pattern.isDefaultValue(key)) {</span>
                // no default value
                // the first entry in the array is the full pattern
                // see net.sf.jabref.logic.labelPattern.LabelPatternUtil.split(String)
<span class="nc" id="L1170">                pre.put(key, pattern.getValue(key).get(0));</span>
            }
        }
<span class="nc" id="L1173">    }</span>

    public Map&lt;String, Object&gt; getPreferences() {
<span class="nc" id="L1176">        Map&lt;String, Object&gt; prefs = new HashMap&lt;&gt;();</span>
        try {
<span class="nc bnc" id="L1178" title="All 2 branches missed.">            for(String key : this.prefs.keys()){</span>
<span class="nc" id="L1179">                Object value = getObject(key);</span>
<span class="nc" id="L1180">                prefs.put(key, value);</span>
            }
<span class="nc" id="L1182">        } catch (BackingStoreException e) {</span>
<span class="nc" id="L1183">            LOGGER.info(&quot;could not retrieve preference keys&quot;, e);</span>
        }
<span class="nc" id="L1185">        return prefs;</span>
    }

    private Object getObject(String key) {
        try {
<span class="nc" id="L1190">            return this.get(key);</span>
<span class="nc" id="L1191">        } catch (ClassCastException e) {</span>
            try {
<span class="nc" id="L1193">                return this.getBoolean(key);</span>
<span class="nc" id="L1194">            } catch (ClassCastException e2) {</span>
<span class="nc" id="L1195">                return this.getInt(key);</span>
            }
        }
    }


    private static String getNextUnit(Reader data) throws IOException {
        // character last read
        // -1 if end of stream
        // initialization necessary, because of Java compiler
<span class="fc" id="L1205">        int c = -1;</span>

        // last character was escape symbol
<span class="fc" id="L1208">        boolean escape = false;</span>

        // true if a &quot;;&quot; is found
<span class="fc" id="L1211">        boolean done = false;</span>

<span class="fc" id="L1213">        StringBuilder res = new StringBuilder();</span>
<span class="fc bfc" id="L1214" title="All 4 branches covered.">        while (!done &amp;&amp; ((c = data.read()) != -1)) {</span>
<span class="pc bpc" id="L1215" title="1 of 2 branches missed.">            if (c == '\\') {</span>
<span class="nc bnc" id="L1216" title="All 2 branches missed.">                if (escape) {</span>
<span class="nc" id="L1217">                    escape = false;</span>
<span class="nc" id="L1218">                    res.append('\\');</span>
<span class="nc" id="L1219">                } else {</span>
<span class="nc" id="L1220">                    escape = true;</span>
                }
<span class="nc" id="L1222">            } else {</span>
<span class="fc bfc" id="L1223" title="All 2 branches covered.">                if (c == ';') {</span>
<span class="pc bpc" id="L1224" title="1 of 2 branches missed.">                    if (escape) {</span>
<span class="nc" id="L1225">                        res.append(';');</span>
<span class="nc" id="L1226">                    } else {</span>
<span class="fc" id="L1227">                        done = true;</span>
                    }
<span class="fc" id="L1229">                } else {</span>
<span class="fc" id="L1230">                    res.append((char) c);</span>
                }
<span class="fc" id="L1232">                escape = false;</span>
            }
        }
<span class="fc bfc" id="L1235" title="All 2 branches covered.">        if (res.length() &gt; 0) {</span>
<span class="fc" id="L1236">            return res.toString();</span>
<span class="pc bpc" id="L1237" title="1 of 2 branches missed.">        } else if (c == -1) {</span>
            // end of stream
<span class="fc" id="L1239">            return null;</span>
        } else {
<span class="nc" id="L1241">            return &quot;&quot;;</span>
        }
    }

    /**
     * Stores all information about the entry type in preferences, with the tag given by number.
     */
    public void storeCustomEntryType(CustomEntryType tp, int number) {
<span class="nc" id="L1249">        String nr = String.valueOf(number);</span>
<span class="nc" id="L1250">        put(JabRefPreferences.CUSTOM_TYPE_NAME + nr, tp.getName());</span>
<span class="nc" id="L1251">        put(JabRefPreferences.CUSTOM_TYPE_REQ + nr, tp.getRequiredFieldsString());</span>
<span class="nc" id="L1252">        List&lt;String&gt; optionalFields = tp.getOptionalFields();</span>
<span class="nc" id="L1253">        putStringList(JabRefPreferences.CUSTOM_TYPE_OPT + nr, optionalFields);</span>
<span class="nc" id="L1254">        List&lt;String&gt; primaryOptionalFields = tp.getPrimaryOptionalFields();</span>
<span class="nc" id="L1255">        putStringList(JabRefPreferences.CUSTOM_TYPE_PRIOPT + nr, primaryOptionalFields);</span>
<span class="nc" id="L1256">    }</span>

    /**
     * Retrieves all information about the entry type in preferences, with the tag given by number.
     */
    public CustomEntryType getCustomEntryType(int number) {
<span class="fc" id="L1262">        String nr = String.valueOf(number);</span>
<span class="fc" id="L1263">        String name = get(JabRefPreferences.CUSTOM_TYPE_NAME + nr);</span>
<span class="pc bpc" id="L1264" title="1 of 2 branches missed.">        if (name == null) {</span>
<span class="fc" id="L1265">            return null;</span>
        }
<span class="nc" id="L1267">        List&lt;String&gt; req = getStringList(JabRefPreferences.CUSTOM_TYPE_REQ + nr);</span>
<span class="nc" id="L1268">        List&lt;String&gt; opt = getStringList(JabRefPreferences.CUSTOM_TYPE_OPT + nr);</span>
<span class="nc" id="L1269">        List&lt;String&gt; priOpt = getStringList(JabRefPreferences.CUSTOM_TYPE_PRIOPT + nr);</span>
<span class="nc bnc" id="L1270" title="All 2 branches missed.">        if (priOpt.isEmpty()) {</span>
<span class="nc" id="L1271">            return new CustomEntryType(EntryUtil.capitalizeFirst(name), req, opt);</span>
        }
<span class="nc" id="L1273">        List&lt;String&gt; secondary = new ArrayList&lt;&gt;(opt);</span>
<span class="nc" id="L1274">        secondary.removeAll(priOpt);</span>

<span class="nc" id="L1276">        return new CustomEntryType(EntryUtil.capitalizeFirst(name), req, priOpt, secondary);</span>

    }


    /**
     * Removes all information about custom entry types with tags of
     *
     * @param number or higher.
     */
    public void purgeCustomEntryTypes(int number) {
<span class="fc" id="L1287">        purgeSeries(JabRefPreferences.CUSTOM_TYPE_NAME, number);</span>
<span class="fc" id="L1288">        purgeSeries(JabRefPreferences.CUSTOM_TYPE_REQ, number);</span>
<span class="fc" id="L1289">        purgeSeries(JabRefPreferences.CUSTOM_TYPE_OPT, number);</span>
<span class="fc" id="L1290">        purgeSeries(JabRefPreferences.CUSTOM_TYPE_PRIOPT, number);</span>
<span class="fc" id="L1291">    }</span>

    public void purgeCustomEntryTypes() {
<span class="nc" id="L1294">        int number = 0;</span>
<span class="nc bnc" id="L1295" title="All 2 branches missed.">        if(getCustomEntryType(number) != null) {</span>
<span class="nc" id="L1296">            number++;</span>
        }

<span class="nc bnc" id="L1299" title="All 2 branches missed.">        for(int i = 0; i &lt; number; i++) {</span>
<span class="nc" id="L1300">            purgeCustomEntryTypes(i);</span>
        }
<span class="nc" id="L1302">    }</span>

    /**
     * Removes all entries keyed by prefix+number, where number is equal to or higher than the given number.
     *
     * @param number or higher.
     */
    public void purgeSeries(String prefix, int number) {
<span class="fc" id="L1310">        int n = number;</span>
<span class="pc bpc" id="L1311" title="1 of 2 branches missed.">        while (get(prefix + n) != null) {</span>
<span class="nc" id="L1312">            remove(prefix + n);</span>
<span class="nc" id="L1313">            n++;</span>
        }
<span class="fc" id="L1315">    }</span>

    public EntryEditorTabList getEntryEditorTabList() {
<span class="fc bfc" id="L1318" title="All 2 branches covered.">        if (tabList == null) {</span>
<span class="fc" id="L1319">            updateEntryEditorTabList();</span>
        }
<span class="fc" id="L1321">        return tabList;</span>
    }

    public void updateEntryEditorTabList() {
<span class="fc" id="L1325">        tabList = new EntryEditorTabList();</span>
<span class="fc" id="L1326">    }</span>

    /**
     * Exports Preferences to an XML file.
     *
     * @param filename String File to export to
     */
    public void exportPreferences(String filename) throws JabRefException {
<span class="nc" id="L1334">        File f = new File(filename);</span>
<span class="nc" id="L1335">        try (OutputStream os = new FileOutputStream(f)) {</span>
<span class="nc" id="L1336">            prefs.exportSubtree(os);</span>
<span class="nc" id="L1337">        } catch (BackingStoreException | IOException ex) {</span>
<span class="nc" id="L1338">            throw new JabRefException(&quot;Could not export preferences&quot;, Localization.lang(&quot;Could not export preferences&quot;), ex);</span>
        }
<span class="nc" id="L1340">    }</span>

    /**
     * Imports Preferences from an XML file.
     *
     * @param filename String File to import from
     * @throws JabRefException thrown if importing the preferences failed due to an InvalidPreferencesFormatException
     *                         or an IOException
     */
    public void importPreferences(String filename) throws JabRefException {
<span class="nc" id="L1350">        File f = new File(filename);</span>
<span class="nc" id="L1351">        try (InputStream is = new FileInputStream(f)) {</span>
<span class="nc" id="L1352">            Preferences.importPreferences(is);</span>
<span class="nc" id="L1353">        } catch (InvalidPreferencesFormatException | IOException ex) {</span>
<span class="nc" id="L1354">            throw new JabRefException(&quot;Could not import preferences&quot;, Localization.lang(&quot;Could not import preferences&quot;),</span>
<span class="nc" id="L1355">                    ex);</span>
        }
<span class="nc" id="L1357">    }</span>

    /**
     * ONLY FOR TESTING!
     *
     * Do not use in production code. Otherwise the singleton pattern is broken and preferences might get lost.
     *
     * @param owPrefs
     */
    public void overwritePreferences(JabRefPreferences owPrefs) {
<span class="nc" id="L1367">        singleton = owPrefs;</span>
<span class="nc" id="L1368">    }</span>

    public Charset getDefaultEncoding() {
<span class="fc" id="L1371">        return Charset.forName(get(JabRefPreferences.DEFAULT_ENCODING));</span>
    }

    public void setDefaultEncoding(Charset encoding) {
<span class="nc" id="L1375">        put(JabRefPreferences.DEFAULT_ENCODING, encoding.name());</span>
<span class="nc" id="L1376">    }</span>

    private static void insertCleanupPreset(Map&lt;String, Object&gt; storage, CleanupPreset preset) {
<span class="fc" id="L1379">        storage.put(CLEANUP_DOI, preset.isCleanUpDOI());</span>
<span class="fc" id="L1380">        storage.put(CLEANUP_MOVE_PDF, preset.isMovePDF());</span>
<span class="fc" id="L1381">        storage.put(CLEANUP_MAKE_PATHS_RELATIVE, preset.isMakePathsRelative());</span>
<span class="fc" id="L1382">        storage.put(CLEANUP_RENAME_PDF, preset.isRenamePDF());</span>
<span class="fc" id="L1383">        storage.put(CLEANUP_RENAME_PDF_ONLY_RELATIVE_PATHS, preset.isRenamePdfOnlyRelativePaths());</span>
<span class="fc" id="L1384">        storage.put(CLEANUP_UPGRADE_EXTERNAL_LINKS, preset.isCleanUpUpgradeExternalLinks());</span>
<span class="fc" id="L1385">        storage.put(CLEANUP_CONVERT_TO_BIBLATEX, preset.isConvertToBiblatex());</span>
<span class="fc" id="L1386">        storage.put(CLEANUP_FIX_FILE_LINKS, preset.isFixFileLinks());</span>
<span class="fc" id="L1387">        storage.put(CLEANUP_FORMATTERS, convertListToString(preset.getFormatterCleanups().convertToString()));</span>
<span class="fc" id="L1388">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span>JabRefMain (11 de nov. de 2021 10:35:43)</div></body></html>